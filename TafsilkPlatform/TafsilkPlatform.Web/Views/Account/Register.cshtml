@{
    ViewData["Title"] = "Create Account | Tafsilk";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/account/auth-shared.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/account/register.css" asp-append-version="true" />
}

<div class="auth-container fade-in">
    <!-- Left Side - Brand/Image -->
    <div class="auth-left register-bg">
        <div class="brand-content">
            <div class="brand-logo mb-4">
                <i class="fas fa-cut fa-2x text-warning"></i>
                <span class="h2 ms-2 text-white">Tafsilk</span>
            </div>
            <h1 class="display-4 fw-bold mb-4">Join the Elite</h1>
            <p class="lead mb-5">Discover a world of creativity and opportunities with the largest network of tailors.</p>
            
            <div class="features-list">
                <div class="feature-item mb-4">
                    <h5 class="text-white"><i class="fas fa-users me-2 text-warning"></i> For Customers</h5>
                    <p class="text-white-50 ms-4">Connect with over 300+ trusted tailors and get your perfect fit.</p>
                </div>
                <div class="feature-item">
                    <h5 class="text-white"><i class="fas fa-cut me-2 text-warning"></i> For Tailors</h5>
                    <p class="text-white-50 ms-4">Showcase your work and grow your business with our platform.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Side - Register Form -->
    <div class="auth-right">
        <div class="auth-card">
            <div class="text-center mb-4">
                <h2 class="auth-title" id="formTitle">Create Account</h2>
                <p class="auth-subtitle">Join our creative network for free</p>
            </div>

            <!-- User Type Toggle -->
            <div class="user-type-toggle mb-4" id="userTypeToggle">
                <button type="button" class="user-type-option active" data-type="tailor">
                    <i class="fas fa-cut mb-1"></i>
                    <span>Tailor</span>
                </button>
                <button type="button" class="user-type-option" data-type="customer">
                    <i class="fas fa-user mb-1"></i>
                    <span>Customer</span>
                </button>
            </div>

            <form asp-action="Register" asp-controller="Account" method="post" id="registerForm">
                @Html.AntiForgeryToken()
                <input type="hidden" id="userType" name="userType" value="tailor" />

                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger mb-4" role="alert">
                        @Html.ValidationSummary(false, "", new { @class = "mb-0" })
                    </div>
                }

                <button type="button" class="btn-google" onclick="location.href='@Url.Action("GoogleLogin", "Account")'">
                    <i class="fab fa-google text-danger"></i>
                    Sign up with Google
                </button>

                <div class="divider">
                    <span>OR</span>
                </div>

                <div class="form-group">
                    <label for="name" class="form-label">Full Name</label>
                    <input type="text" id="name" name="name" class="form-control" placeholder="Enter your full name" required />
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" name="email" class="form-control" placeholder="name@example.com" required />
                </div>

                <div class="form-group">
                    <label for="phone" class="form-label">Phone Number <span class="text-muted small fw-normal">(Optional)</span></label>
                    <input type="tel" id="phone" name="phoneNumber" class="form-control" placeholder="+20 1X XXX XXXX" />
                    <div class="form-text text-muted small">Only Egyptian numbers allowed (+20)</div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" id="password" name="password" class="form-control" placeholder="6+ characters" required />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">Confirm</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" placeholder="Repeat password" required />
                        </div>
                    </div>
                </div>

                <div class="form-check mb-4">
                    <input type="checkbox" class="form-check-input" id="terms" required>
                    <label class="form-check-label small text-muted" for="terms">
                        I agree to the <a href="#" class="auth-link">Terms of Service</a> and <a href="#" class="auth-link">Privacy Policy</a>
                    </label>
                </div>

                <button type="submit" class="btn-primary">
                    <span>Create Account</span>
                    <i class="fas fa-user-plus"></i>
                </button>

                <div class="text-center mt-4">
                    <p class="text-muted">
                        Already have an account? 
                        <a href="@Url.Action("Login", "Account")" class="auth-link">Sign In</a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const userTypeOptions = document.querySelectorAll(".user-type-option");
            const userTypeInput = document.getElementById("userType");
            const formTitle = document.getElementById("formTitle");
            
            // User Type Toggle
            userTypeOptions.forEach((option) => {
                option.addEventListener("click", function () {
                    userTypeOptions.forEach((opt) => opt.classList.remove("active"));
                    this.classList.add("active");
                    
                    const type = this.getAttribute("data-type");
                    userTypeInput.value = type;
                    
                    if (type === "tailor") {
                        formTitle.textContent = "Join as a Tailor";
                    } else {
                        formTitle.textContent = "Join as a Customer";
                    }
                });
            });

            // Phone Number Validation (Egypt +20)
            const phoneInput = document.getElementById('phone');
            
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d+]/g, ''); // Remove non-digits/plus
                
                // Ensure it starts with +20
                if (value.length > 0 && !value.startsWith('+20')) {
                    if (value.startsWith('0')) {
                        value = '+2' + value; // Convert 010... to +2010...
                    } else if (value.startsWith('20')) {
                        value = '+' + value;
                    } else {
                        value = '+20' + value.replace(/^\+/, '');
                    }
                }
                
                // Limit length (Egypt numbers are +20 + 10 digits = 13 chars)
                if (value.length > 13) {
                    value = value.substring(0, 13);
                }
                
                e.target.value = value;
            });

            phoneInput.addEventListener('blur', function() {
                const value = this.value;
                if (value && value.length > 0) {
                    // Regex for Egypt mobile: +20 followed by 10, 11, 12, 15 and 8 digits
                    const egyptRegex = /^\+201[0125][0-9]{8}$/;
                    if (!egyptRegex.test(value)) {
                        alert("Please enter a valid Egyptian phone number starting with +20 (e.g., +201012345678)");
                        this.classList.add('is-invalid');
                    } else {
                        this.classList.remove('is-invalid');
                    }
                }
            });

            // Simple validation
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                const password = document.getElementById('password').value;
                const confirm = document.getElementById('confirmPassword').value;
                
                if (password !== confirm) {
                    e.preventDefault();
                    alert("Passwords do not match!");
                }
            });
        });
    </script>
}
