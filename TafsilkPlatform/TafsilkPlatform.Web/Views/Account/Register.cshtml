@{
    ViewData["Title"] = "Create Account | Tafsilk";
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
}

@section Styles {
}

<!-- Background Blobs -->
<div class="auth-background">
    <div class="auth-blob blob-1"></div>
    <div class="auth-blob blob-2"></div>
</div>

<div class="auth-container">
    <!-- Left Side: Visual -->
    <div class="auth-visual">
        <div class="visual-content">
            <a href="/Home/Index" class="brand-logo text-decoration-none">
                <i class="fas fa-cut"></i> Tafsilk
            </a>
            <h1 class="visual-heading">Join the<br>Elite.</h1>
            <p class="visual-text">
                Connect with the finest tailors or showcase your masterpiece to the world.
            </p>
        </div>
    </div>

    <!-- Right Side: Form -->
    <div class="auth-form-container">
        <div class="auth-header">
            <h2 class="auth-title" id="formTitle">Create Account</h2>
            <p class="auth-subtitle">Start your journey today</p>
        </div>

        <!-- User Type Toggle -->
        <div class="user-type-toggle mb-4" id="userTypeToggle">
            <button type="button" class="user-type-option active" data-type="tailor">
                <i class="fas fa-cut mb-1"></i>
                <span>Tailor</span>
            </button>
            <button type="button" class="user-type-option" data-type="customer">
                <i class="fas fa-user mb-1"></i>
                <span>Customer</span>
            </button>
        </div>

        <form asp-action="Register" asp-controller="Account" method="post" id="registerForm">
            @Html.AntiForgeryToken()
            <input type="hidden" id="userType" name="userType" value="tailor" />

            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger mb-4" role="alert">
                    @Html.ValidationSummary(false, "", new { @class = "mb-0" })
                </div>
            }

            <button type="button" class="btn-google" onclick="location.href='@Url.Action("GoogleLogin", "Account")'">
                <i class="fab fa-google text-danger"></i>
                Sign up with Google
            </button>

            <div class="divider">
                <span>OR EMAIL</span>
            </div>

            <div class="form-group">
                <i class="fas fa-user input-icon"></i>
                <input type="text" id="name" name="name" class="form-control" placeholder="Full Name" required />
            </div>

            <div class="form-group">
                <i class="fas fa-envelope input-icon"></i>
                <input type="email" id="email" name="email" class="form-control" placeholder="Email Address" required />
            </div>

            <div class="form-group">
                <i class="fas fa-phone input-icon"></i>
                <input type="tel" id="phone" name="phoneNumber" class="form-control" placeholder="Phone (Optional)" />
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="password" name="password" class="form-control" placeholder="Password" required />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" placeholder="Confirm" required />
                    </div>
                </div>
            </div>

            <div class="form-check mb-4">
                <input type="checkbox" class="form-check-input" id="terms" required>
                <label class="form-check-label small text-muted" for="terms">
                    I agree to the <a asp-controller="Home" asp-action="Terms" class="auth-link">Terms</a> and <a asp-controller="Home" asp-action="Privacy" class="auth-link">Privacy Policy</a>
                </label>
            </div>

            <button type="submit" class="btn-premium">
                <span>Create Account</span>
                <i class="fas fa-user-plus"></i>
            </button>

            <div class="text-center mt-4">
                <p class="text-muted small">
                    Already have an account? 
                    <a href="@Url.Action("Login", "Account")" class="auth-link fw-bold">Sign In</a>
                </p>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const userTypeOptions = document.querySelectorAll(".user-type-option");
            const userTypeInput = document.getElementById("userType");
            const formTitle = document.getElementById("formTitle");
            
            // User Type Toggle
            userTypeOptions.forEach((option) => {
                option.addEventListener("click", function () {
                    userTypeOptions.forEach((opt) => opt.classList.remove("active"));
                    this.classList.add("active");
                    
                    const type = this.getAttribute("data-type");
                    userTypeInput.value = type;
                    
                    if (type === "tailor") {
                        formTitle.textContent = "Join as a Tailor";
                    } else {
                        formTitle.textContent = "Join as a Customer";
                    }
                });
            });

            // Phone Number Validation (Egypt +20)
            const phoneInput = document.getElementById('phone');
            
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d+]/g, ''); // Remove non-digits/plus
                
                // Ensure it starts with +20
                if (value.length > 0 && !value.startsWith('+20')) {
                    if (value.startsWith('0')) {
                        value = '+2' + value; // Convert 010... to +2010...
                    } else if (value.startsWith('20')) {
                        value = '+' + value;
                    } else {
                        value = '+20' + value.replace(/^\+/, '');
                    }
                }
                
                // Limit length (Egypt numbers are +20 + 10 digits = 13 chars)
                if (value.length > 13) {
                    value = value.substring(0, 13);
                }
                
                e.target.value = value;
            });

            phoneInput.addEventListener('blur', function() {
                const value = this.value;
                if (value && value.length > 0) {
                    // Regex for Egypt mobile: +20 followed by 10, 11, 12, 15 and 8 digits
                    const egyptRegex = /^\+201[0125][0-9]{8}$/;
                    if (!egyptRegex.test(value)) {
                        alert("Please enter a valid Egyptian phone number starting with +20 (e.g., +201012345678)");
                        this.classList.add('is-invalid');
                    } else {
                        this.classList.remove('is-invalid');
                    }
                }
            });

            // Simple validation
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                const password = document.getElementById('password').value;
                const confirm = document.getElementById('confirmPassword').value;
                
                if (password !== confirm) {
                    e.preventDefault();
                    alert("Passwords do not match!");
                }
            });
        });
    </script>
}
