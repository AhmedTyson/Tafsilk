@model IEnumerable<TafsilkPlatform.Models.Models.Product>
@{
    ViewData["Title"] = "Products";
}

<div class="glass-card p-4 my-4 container-fluid">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2 small">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "AdminDashboard")" class="text-decoration-none text-muted">Home</a></li>
                <li class="breadcrumb-item active text-white" aria-current="page">Products</li>
            </ol>
        </nav>
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 text-white fw-bold text-uppercase" style="letter-spacing: 1px;">All Products</h1>
                <p class="text-muted small mb-0">Manage all products in the store</p>
            </div>

        </div>
    </div>
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
        <form class="d-flex gap-2 flex-grow-1" style="max-width: 400px;" action="@Url.Action("Products")" method="GET">
            <input type="text" name="search" value="@ViewBag.CurrentSearch" class="form-control bg-dark text-white border-secondary" placeholder="Search products...">
            @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch as string))
            {
                <a href="@Url.Action("Products")" class="btn btn-outline-secondary">Clear</a>
            }
        </form>
    </div>

    <div class="table-responsive rounded">
        <table class="table table-hover glass-table mb-0 align-middle">
            <thead class="bg-dark text-uppercase text-muted small">
                <tr>
                    <th class="py-3 ps-4">Product Name</th>
                    <th class="py-3">Category</th>
                    <th class="py-3">Tailor</th>
                    <th class="py-3">Price</th>
                    <th class="py-3">Stock</th>
                    <th class="py-3">Status</th>
                    <th class="py-3 text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="ps-4 fw-bold text-white">@item.Name</td>
                        <td class="text-muted small">@item.Category</td>
                        <td class="text-white small">@(item.Tailor?.ShopName ?? "Unknown")</td>
                        <td class="fw-bold text-success font-monospace">EGP @item.Price</td>
                        <td class="text-white">@item.StockQuantity</td>
                        <td>
                            @if (item.StockQuantity > 0)
                            {
                                <span class="badge bg-success bg-opacity-25 text-success border border-success">
                                    In Stock
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger bg-opacity-25 text-danger border border-danger">
                                    Out of Stock
                                </span>
                            }
                        </td>
                        <td class="text-end pe-4">
                            <button type="button" 
                                    class="btn btn-sm btn-outline-danger" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#deleteProductModal"
                                    onclick="setDeleteModal('@item.ProductId', '@item.Name')">
                                <i class="fas fa-trash me-1"></i> Delete
                            </button>
                        </td>
                    </tr>
                }
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="7" class="text-center p-5 text-muted fst-italic">
                            No products found.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="deleteProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-white" id="deleteProductModalLabel">Delete Product</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-4">
                <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
                <h4 class="text-white">Are you sure?</h4>
                <p class="text-muted">Do you really want to delete <strong id="delete-product-name" class="text-danger"></strong>? <br>This process cannot be undone (Soft Delete).</p>
            </div>
            <div class="modal-footer border-secondary justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form asp-action="DeleteProduct" method="post" class="d-inline">
                    <input type="hidden" name="productId" id="delete-product-id" />
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function setDeleteModal(id, name) {
            document.getElementById('delete-product-id').value = id;
            document.getElementById('delete-product-name').textContent = name;
        }
    </script>
}
