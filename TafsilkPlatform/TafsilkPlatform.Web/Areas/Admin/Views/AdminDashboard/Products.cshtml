@model IEnumerable<TafsilkPlatform.Models.Models.Product>
@{
    ViewData["Title"] = "إدارة المنتجات";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout_v2.cshtml";
}

<div class="page-header">
    <h1 class="page-title">إدارة المنتجات</h1>
    <div class="page-actions">
        <button class="btn btn-outline">
            <i class="fas fa-filter"></i>
            <span>تصفية</span>
        </button>
        <button class="btn btn-primary">
            <i class="fas fa-plus"></i>
            <span>إضافة منتج</span>
        </button>
    </div>
</div>

<div class="card">
    <table class="datagrid">
        <thead>
            <tr>
                <th>المنتج</th>
                <th>الخياط</th>
                <th>السعر</th>
                <th>المخزون</th>
                <th>الحالة</th>
                <th>تاريخ الإضافة</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="7" class="text-center py-5 text-secondary">
                        <i class="fas fa-box-open fa-2x mb-2 opacity-25"></i>
                        <p>لا توجد منتجات حتى الآن</p>
                    </td>
                </tr>
            }
            else
            {
                @foreach (var product in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar bg-surface-3 text-secondary rounded d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    @if (!string.IsNullOrEmpty(product.PrimaryImageUrl))
                                    {
                                        <img src="@product.PrimaryImageUrl" alt="@product.Name" class="rounded" style="width: 100%; height: 100%; object-fit: cover;">
                                    }
                                    else
                                    {
                                        <i class="fas fa-box"></i>
                                    }
                                </div>
                                <div class="d-flex flex-column">
                                    <span class="font-medium text-primary">@product.Name</span>
                                    <span class="text-xs text-secondary">@product.Category</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar bg-info-bg text-info-text rounded-circle d-flex align-items-center justify-content-center" style="width: 24px; height: 24px; font-size: 0.65rem;">
                                    @(product.Tailor?.ShopName?.Substring(0, 1).ToUpper() ?? "T")
                                </div>
                                <span class="text-sm text-primary">@product.Tailor?.ShopName</span>
                            </div>
                        </td>
                        <td class="font-medium">@product.Price.ToString("C")</td>
                        <td>
                            @if (product.StockQuantity > 0)
                            {
                                <span class="text-success font-medium">@product.StockQuantity</span>
                            }
                            else
                            {
                                <span class="text-danger font-medium">نفذت الكمية</span>
                            }
                        </td>
                        <td>
                            @if (product.IsAvailable)
                            {
                                <span class="badge badge-success">متاح</span>
                            }
                            else
                            {
                                <span class="badge badge-secondary">غير متاح</span>
                            }
                        </td>
                        <td class="text-sm">@product.CreatedAt.ToString("dd/MM/yyyy")</td>
                        <td>
                            <div class="d-flex gap-2">
                                <form asp-action="ToggleProductAvailability" asp-route-id="@product.ProductId" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-outline @(product.IsAvailable ? "text-warning border-warning" : "text-success border-success")" 
                                            title="@(product.IsAvailable ? "إيقاف" : "تفعيل")">
                                        <i class="fas @(product.IsAvailable ? "fa-ban" : "fa-check")"></i>
                                    </button>
                                </form>
                                
                                <form asp-action="DeleteProduct" asp-route-id="@product.ProductId" method="post" 
                                      onsubmit="return confirm('هل أنت متأكد من حذف هذا المنتج؟');" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-outline text-danger border-danger" title="حذف">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
