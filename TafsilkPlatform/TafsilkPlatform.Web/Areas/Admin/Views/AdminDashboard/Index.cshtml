@model TafsilkPlatform.Models.ViewModels.Admin.DashboardHomeViewModel
@{
    ViewData["Title"] = "لوحة التحكم";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout_v2.cshtml";
}

<div class="page-header">
    <h1 class="page-title">لوحة التحكم</h1>
    <div class="page-actions">
        <button class="btn btn-outline" onclick="location.reload()">
            <i class="fas fa-sync-alt"></i>
            <span>تحديث</span>
        </button>
    </div>
</div>

<!-- Stats Grid -->
<div class="grid-cols-4 mb-4">
    <!-- Total Users -->
    <div class="card stat-widget">
        <div class="flex-between">
            <span class="stat-label">إجمالي المستخدمين</span>
            <i class="fas fa-users text-secondary"></i>
        </div>
        <div class="stat-value">@Model.TotalUsers.ToString("N0")</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i>
            <span>12% زيادة عن الشهر الماضي</span>
        </div>
    </div>

    <!-- Active Orders -->
    <div class="card stat-widget">
        <div class="flex-between">
            <span class="stat-label">الطلبات النشطة</span>
            <i class="fas fa-shopping-bag text-secondary"></i>
        </div>
        <div class="stat-value">@Model.ActiveOrders.ToString("N0")</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i>
            <span>8% زيادة في الطلبات</span>
        </div>
    </div>

    <!-- Total Sales (Gross) -->
    <div class="card stat-widget">
        <div class="flex-between">
            <span class="stat-label">إجمالي المبيعات</span>
            <i class="fas fa-money-bill-wave text-secondary"></i>
        </div>
        <div class="stat-value">@Model.TotalSales.ToString("C")</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i>
            <span>إجمالي قيمة الطلبات</span>
        </div>
    </div>

    <!-- Tafsilk Revenue (Commission) -->
    <div class="card stat-widget">
        <div class="flex-between">
            <span class="stat-label">أرباح تفصيلك (العمولة)</span>
            <i class="fas fa-coins text-secondary"></i>
        </div>
        <div class="stat-value">@Model.TotalRevenue.ToString("C")</div>
        <div class="stat-trend up">
            <i class="fas fa-arrow-up"></i>
            <span>صافي الربح (10%)</span>
        </div>
    </div>

    <!-- Pending Reviews -->
    <div class="card stat-widget">
        <div class="flex-between">
            <span class="stat-label">صور للمراجعة</span>
            <i class="fas fa-images text-secondary"></i>
        </div>
        <div class="stat-value">@Model.PendingPortfolioReviews</div>
        @if (Model.PendingPortfolioReviews > 0)
        {
            <div class="stat-trend down">
                <i class="fas fa-exclamation-circle"></i>
                <span>يحتاج لاتخاذ إجراء</span>
            </div>
        }
        else
        {
            <div class="stat-trend text-secondary">
                <i class="fas fa-check"></i>
                <span>لا توجد مهام معلقة</span>
            </div>
        }
    </div>
</div>

<!-- Charts & Activity -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
    <!-- Revenue Chart -->
    <div class="card">
        <div class="flex-between mb-4">
            <h3 class="text-lg font-bold m-0">نظرة عامة على الإيرادات</h3>
            <select class="form-select" style="padding: 0.25rem; border: 1px solid var(--border-subtle); border-radius: var(--radius-sm);">
                <option>هذا العام</option>
                <option>آخر 6 أشهر</option>
            </select>
        </div>
        <div style="height: 300px;">
            <canvas id="revenueChart"></canvas>
        </div>
    </div>

    <!-- Order Status -->
    <div class="card">
        <h3 class="text-lg font-bold mb-4 m-0">حالة الطلبات</h3>
        <div style="height: 250px; display: flex; align-items: center; justify-content: center;">
            <canvas id="ordersChart"></canvas>
        </div>
        <div class="mt-4 pt-4 border-top border-subtle">
            <div class="flex-between text-sm mb-2">
                <span class="text-secondary">مكتمل</span>
                <span class="font-medium">65%</span>
            </div>
            <div class="flex-between text-sm">
                <span class="text-secondary">قيد التنفيذ</span>
                <span class="font-medium">20%</span>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card">
    <div class="flex-between mb-4">
        <h3 class="text-lg font-bold m-0">النشاط الحديث</h3>
        <a href="@Url.Action("AuditLogs", "AdminDashboard", new { area = "Admin" })" class="btn btn-sm btn-outline">عرض الكل</a>
    </div>
    
    @if (Model.RecentActivity.Any())
    {
        <table class="datagrid">
            <thead>
                <tr>
                    <th>المستخدم</th>
                    <th>النشاط</th>
                    <th>التاريخ</th>
                    <th>IP Address</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var activity in Model.RecentActivity)
                {
                    <tr>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar bg-surface-3 text-secondary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; font-size: 0.75rem;">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span class="font-medium">@activity.UserName</span>
                            </div>
                        </td>
                        <td>@activity.Action</td>
                        <td>@activity.Timestamp.ToString("dd/MM/yyyy HH:mm")</td>
                        <td class="text-sm font-mono text-tertiary">@activity.IpAddress</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="text-center py-5 text-secondary">
            <i class="fas fa-inbox fa-2x mb-2 opacity-25"></i>
            <p>لا توجد أنشطة حديثة</p>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Chart Config
            Chart.defaults.font.family = "'Inter', 'Cairo', sans-serif";
            Chart.defaults.color = '#64748b';
            
            // Revenue Chart
            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { borderDash: [4, 4] }, beginAtZero: true },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Orders Chart
            new Chart(document.getElementById('ordersChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Processing', 'Pending', 'Cancelled'],
                    datasets: [{
                        data: [65, 20, 10, 5],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: { legend: { display: false } }
                }
            });
        });
    </script>
}
