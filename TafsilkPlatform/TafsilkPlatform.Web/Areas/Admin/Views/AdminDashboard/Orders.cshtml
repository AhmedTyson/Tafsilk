@model IEnumerable<TafsilkPlatform.Models.Models.Order>
@using TafsilkPlatform.Models.Models
@{
    ViewData["Title"] = "Orders";
}

<div class="glass-card p-4 my-4 container-fluid">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2 small">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "AdminDashboard")" class="text-decoration-none text-muted">Home</a></li>
                <li class="breadcrumb-item active text-white" aria-current="page">Orders</li>
            </ol>
        </nav>
        <h1 class="h3 text-white fw-bold text-uppercase" style="letter-spacing: 1px;">All Orders</h1>
        <p class="text-muted small">Manage all orders in the store</p>
    </div>

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
        <form class="d-flex gap-2 flex-grow-1" style="max-width: 400px;" action="@Url.Action("Orders")" method="GET">
            <input type="text" name="search" value="@ViewBag.CurrentSearch" class="form-control bg-dark text-white border-secondary" placeholder="Search orders...">
            @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch as string))
            {
                <a href="@Url.Action("Orders")" class="btn btn-outline-secondary">Clear</a>
            }
        </form>
    </div>

    <div class="table-responsive rounded">
        <table class="table table-hover glass-table mb-0 align-middle">
            <thead class="bg-dark text-uppercase text-muted small">
                <tr>
                    <th class="py-3 ps-4">Order ID</th>
                    <th class="py-3">Customer</th>
                    <th class="py-3">Tailor</th>
                    <th class="py-3">Status</th>
                    <th class="py-3">Total</th>
                    <th class="py-3">Date</th>
                    <th class="py-3 text-end pe-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="ps-4 fw-bold text-white max-w-xs text-truncate" style="max-width: 150px;">
                            #@item.OrderId.ToString().Substring(0, 8)
                        </td>
                        <td>
                            <div class="fw-bold text-white">@(item.Customer?.FullName ?? "Unknown")</div>
                            <div class="small text-muted">@(item.Customer?.User?.Email ?? "-")</div>
                        </td>
                        <td>
                            <div class="fw-bold text-white">@(item.Tailor?.ShopName ?? "System/Unknown")</div>
                        </td>
                        <td>
                            @{
                                var badgeClass = item.Status switch
                                {
                                    OrderStatus.Delivered => "bg-success bg-opacity-25 text-success border-success",
                                    OrderStatus.Cancelled => "bg-danger bg-opacity-25 text-danger border-danger",
                                    OrderStatus.Pending => "bg-warning bg-opacity-25 text-warning border-warning",
                                    OrderStatus.Processing => "bg-primary bg-opacity-25 text-primary border-primary",
                                    OrderStatus.Shipped => "bg-info bg-opacity-25 text-info border-info",
                                    _ => "bg-secondary text-light"
                                };
                            }
                            <span class="badge border @badgeClass">@item.Status</span>
                        </td>
                        <td class="fw-bold text-success font-monospace">
                            EGP @item.TotalPrice.ToString("N2")
                        </td>
                        <td class="text-muted small">
                            @item.CreatedAt.ToString("MMM dd, yyyy")
                        </td>
                        <td class="text-end pe-4">
                            <a href="@Url.Action("OrderDetails", "AdminDashboard", new { id = item.OrderId, area = "Admin" })" class="btn btn-sm btn-primary">
                                Details
                            </a>
                        </td>
                    </tr>
                }
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="7" class="text-center p-5 text-muted fst-italic">
                            No orders found.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
