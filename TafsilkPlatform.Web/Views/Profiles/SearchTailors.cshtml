@model List<TafsilkPlatform.Web.Models.TailorProfile>

@{
    ViewData["Title"] = "البحث عن خياطين";
    var currentCity = ViewBag.CurrentCity as string;
    var currentServiceType = ViewBag.CurrentServiceType as string;
    var currentPage = ViewBag.CurrentPage as int? ?? 1;
    var totalPages = ViewBag.TotalPages as int? ?? 1;
    var totalResults = ViewBag.TotalResults as int? ?? 0;
}

<div class="container py-5">
 <!-- Search Header -->
    <div class="search-header mb-5">
   <div class="text-center mb-4">
            <h1 class="display-4 fw-bold">
   <i class="fas fa-search me-3"></i>ابحث عن أفضل الخياطين
      </h1>
      <p class="lead text-muted">اكتشف خياطين محترفين بالقرب منك</p>
        </div>

<!-- Search Filters -->
      <div class="card border-0 shadow-sm">
       <div class="card-body p-4">
    <form asp-action="SearchTailors" method="get" class="row g-3">
         <div class="col-md-4">
      <label class="form-label fw-bold">
   <i class="fas fa-city me-2"></i>المدينة
 </label>
         <input type="text" name="city" class="form-control form-control-lg" 
      value="@currentCity" placeholder="أدخل المدينة" />
          </div>
    
      <div class="col-md-4">
   <label class="form-label fw-bold">
      <i class="fas fa-scissors me-2"></i>نوع الخدمة
    </label>
         <input type="text" name="serviceType" class="form-control form-control-lg" 
  value="@currentServiceType" placeholder="مثال: تفصيل ثوب" />
       </div>
      
     <div class="col-md-4 d-flex align-items-end">
        <button type="submit" class="btn btn-primary btn-lg w-100">
 <i class="fas fa-search me-2"></i>بحث
   </button>
   </div>
       </form>
  </div>
      </div>
 </div>

    <!-- Search Results -->
    @if (totalResults > 0)
 {
        <div class="mb-4">
  <h5 class="text-muted">
         <i class="fas fa-check-circle text-success me-2"></i>
       تم العثور على @totalResults خياط
            </h5>
        </div>

      <div class="row">
         @foreach (var tailor in Model)
 {
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card tailor-card h-100 border-0 shadow-sm">
       <!-- Profile Picture -->
     <div class="card-img-top position-relative" style="height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
       @if (tailor.ProfilePictureData != null)
     {
      <img src="@Url.Action("ProfilePicture", "Account", new { userId = tailor.UserId })" 
   alt="@tailor.ShopName" class="w-100 h-100" style="object-fit: cover;" />
         }
  else
   {
     <div class="d-flex align-items-center justify-content-center h-100">
            <i class="fas fa-store fa-4x text-white opacity-75"></i>
         </div>
   }
   
    @if (tailor.IsVerified)
  {
   <span class="position-absolute top-0 end-0 m-3 badge bg-success">
    <i class="fas fa-check-circle me-1"></i>موثق
      </span>
     }
     </div>

         <div class="card-body">
  <h5 class="card-title mb-3">
           <i class="fas fa-store me-2 text-primary"></i>
      @tailor.ShopName
        </h5>

     <div class="mb-3">
        <div class="d-flex align-items-center mb-2">
      <i class="fas fa-star text-warning me-2"></i>
    <span class="fw-bold">@(tailor.Reviews.Any() ? tailor.Reviews.Average(r => r.Rating).ToString("F1") : "جديد")</span>
     <span class="text-muted ms-2">(@tailor.Reviews.Count تقييم)</span>
          </div>
       
 <div class="text-muted small">
  <i class="fas fa-map-marker-alt me-2"></i>
        @tailor.City
  </div>
   </div>

  @if (tailor.ExperienceYears.HasValue)
     {
    <div class="mb-3">
        <span class="badge bg-light text-dark">
   <i class="fas fa-award me-1"></i>
     @tailor.ExperienceYears سنة خبرة
      </span>
     </div>
    }

         <!-- Services Preview -->
   @if (tailor.TailorServices.Any())
    {
      <div class="services-preview mb-3">
       <small class="text-muted d-block mb-2">الخدمات المتاحة:</small>
       <div class="d-flex flex-wrap gap-1">
      @foreach (var service in tailor.TailorServices.Take(3))
         {
         <span class="badge bg-light text-dark">@service.ServiceName</span>
        }
     @if (tailor.TailorServices.Count > 3)
     {
        <span class="badge bg-light text-muted">+@(tailor.TailorServices.Count - 3) أخرى</span>
}
   </div>
       </div>
        }

   <a asp-action="ViewPublicTailorProfile" asp-route-id="@tailor.Id" 
    class="btn btn-primary w-100">
      <i class="fas fa-eye me-2"></i>عرض الملف الشخصي
 </a>
   </div>
       </div>
   </div>
   }
  </div>

        <!-- Pagination -->
   @if (totalPages > 1)
        {
  <nav aria-label="نتائج البحث">
     <ul class="pagination justify-content-center">
    <li class="page-item @(currentPage == 1 ? "disabled" : "")">
      <a class="page-link" href="@Url.Action("SearchTailors", new { city = currentCity, serviceType = currentServiceType, page = currentPage - 1 })">
 السابق
 </a>
 </li>

  @for (int i = 1; i <= totalPages; i++)
  {
      <li class="page-item @(i == currentPage ? "active" : "")">
    <a class="page-link" href="@Url.Action("SearchTailors", new { city = currentCity, serviceType = currentServiceType, page = i })">
      @i
     </a>
     </li>
     }

      <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
   <a class="page-link" href="@Url.Action("SearchTailors", new { city = currentCity, serviceType = currentServiceType, page = currentPage + 1 })">
التالي
</a>
  </li>
            </ul>
  </nav>
        }
 }
    else
 {
      <!-- No Results -->
        <div class="text-center py-5">
  <i class="fas fa-search fa-4x text-muted mb-4"></i>
      <h4>لم يتم العثور على نتائج</h4>
        <p class="text-muted">جرب البحث بمصطلحات أخرى أو تصفح جميع الخياطين</p>
      <a asp-action="SearchTailors" class="btn btn-primary">
       <i class="fas fa-redo me-2"></i>إعادة تعيين البحث
      </a>
</div>
    }
</div>

@section Styles {
<style>
 .search-header {
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  padding: 3rem;
        border-radius: 16px;
        margin-bottom: 2rem;
    }

    .tailor-card {
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .tailor-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 12px 30px rgba(0,0,0,0.15) !important;
    }

    .services-preview {
 background: #f8f9fa;
        padding: 0.75rem;
  border-radius: 8px;
    }

    .pagination .page-link {
 color: #2c5aa0;
    }

    .pagination .page-item.active .page-link {
        background-color: #2c5aa0;
        border-color: #2c5aa0;
    }
</style>
}
