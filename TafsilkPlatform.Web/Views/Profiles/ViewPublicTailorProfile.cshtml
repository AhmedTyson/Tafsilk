@model TafsilkPlatform.Web.Models.TailorProfile

@{
    ViewData["Title"] = Model.ShopName;
    var averageRating = Model.Reviews.Any() ? Model.Reviews.Average(r => r.Rating) : 0;
    var reviewCount = Model.Reviews.Count;
}

<div class="container py-5">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Profile Header -->
            <div class="card border-0 shadow-sm mb-4">
       <div class="card-body p-0">
        <!-- Cover Image -->
        <div class="profile-cover" style="height: 250px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative;">
         @if (Model.IsVerified)
      {
              <div class="position-absolute top-0 end-0 m-4">
    <span class="badge bg-success fs-6 px-3 py-2">
        <i class="fas fa-check-circle me-2"></i>خياط موثق
    </span>
         </div>
   }
   </div>

          <div class="p-4">
      <div class="d-flex align-items-start gap-4">
  <!-- Profile Picture -->
     <div class="profile-picture" style="margin-top: -80px;">
 @if (Model.ProfilePictureData != null)
      {
             <img src="@Url.Action("ProfilePicture", "Account", new { userId = Model.UserId })" 
    alt="@Model.ShopName" 
        class="rounded-circle border border-4 border-white shadow-lg" 
        style="width: 150px; height: 150px; object-fit: cover;" />
            }
         else
         {
              <div class="rounded-circle border border-4 border-white shadow-lg bg-light d-flex align-items-center justify-content-center" 
    style="width: 150px; height: 150px;">
   <i class="fas fa-store fa-3x text-muted"></i>
          </div>
    }
      </div>

     <!-- Profile Info -->
  <div class="flex-grow-1" style="padding-top: 20px;">
             <h1 class="mb-2">@Model.ShopName</h1>
    
       <div class="d-flex align-items-center gap-3 mb-3">
<div class="rating-display">
   @for (int i = 1; i <= 5; i++)
                {
          if (i <= averageRating)
         {
       <i class="fas fa-star text-warning"></i>
             }
        else if (i - averageRating < 1)
  {
          <i class="fas fa-star-half-alt text-warning"></i>
            }
          else
       {
        <i class="far fa-star text-warning"></i>
          }
 }
      <span class="ms-2 fw-bold">@averageRating.ToString("F1")</span>
          <span class="text-muted ms-1">(@reviewCount تقييم)</span>
              </div>
                </div>

       <div class="d-flex flex-wrap gap-3 mb-3">
                 <div class="text-muted">
  <i class="fas fa-map-marker-alt me-2"></i>
          @Model.City, @Model.Address
     </div>

            @if (Model.ExperienceYears.HasValue)
       {
          <div class="text-muted">
 <i class="fas fa-award me-2"></i>
    @Model.ExperienceYears سنة خبرة
        </div>
   }
 </div>

         @if (User.Identity?.IsAuthenticated == true && User.IsInRole("Customer"))
                 {
      <div class="d-flex gap-2">
               <button class="btn btn-primary">
     <i class="fas fa-calendar-check me-2"></i>حجز موعد
           </button>
        <button class="btn btn-outline-secondary">
          <i class="fas fa-heart me-2"></i>إضافة للمفضلة
    </button>
      <button class="btn btn-outline-secondary">
        <i class="fas fa-share-alt me-2"></i>مشاركة
          </button>
                   </div>
         }
            </div>
        </div>
        </div>
             </div>
            </div>

      <!-- About Section -->
         @if (!string.IsNullOrWhiteSpace(Model.Bio))
     {
        <div class="card border-0 shadow-sm mb-4">
     <div class="card-body p-4">
        <h4 class="mb-3">
    <i class="fas fa-info-circle me-2 text-primary"></i>نبذة عن المحل
         </h4>
         <p class="text-muted mb-0">@Model.Bio</p>
        </div>
          </div>
            }

            <!-- Services Section -->
            @if (Model.TailorServices.Any())
  {
                <div class="card border-0 shadow-sm mb-4">
         <div class="card-body p-4">
       <h4 class="mb-4">
         <i class="fas fa-scissors me-2 text-primary"></i>الخدمات المتاحة
       </h4>
       
               <div class="row g-3">
      @foreach (var service in Model.TailorServices)
        {
   <div class="col-md-6">
              <div class="service-item p-3 border rounded h-100">
  <div class="d-flex justify-content-between align-items-start mb-2">
        <h6 class="mb-0 fw-bold">@service.ServiceName</h6>
    <span class="badge bg-primary">@service.BasePrice ريال</span>
   </div>
          <p class="text-muted small mb-2">@service.Description</p>
        <div class="text-muted small">
      <i class="fas fa-clock me-1"></i>
  المدة التقديرية: @service.EstimatedDuration يوم
 </div>
       </div>
  </div>
 }
       </div>
        </div>
     </div>
            }

         <!-- Portfolio Section -->
            @if (Model.PortfolioImages.Any())
            {
        <div class="card border-0 shadow-sm mb-4">
       <div class="card-body p-4">
         <h4 class="mb-4">
     <i class="fas fa-images me-2 text-primary"></i>معرض الأعمال
       </h4>
    
            <div class="row g-3">
      @foreach (var image in Model.PortfolioImages.Take(6))
       {
       <div class="col-md-4">
  <div class="portfolio-item position-relative">
   <img src="@image.ImageUrl" alt="Portfolio" class="w-100 rounded" style="height: 200px; object-fit: cover;" />
          @if (image.IsBeforeAfter)
          {
                 <span class="position-absolute top-0 start-0 m-2 badge bg-info">
        قبل/بعد
     </span>
      }
           </div>
     </div>
      }
    </div>

             @if (Model.PortfolioImages.Count > 6)
    {
  <div class="text-center mt-3">
       <button class="btn btn-outline-primary">
  عرض جميع الأعمال (@Model.PortfolioImages.Count)
             </button>
         </div>
       }
               </div>
     </div>
            }

            <!-- Reviews Section -->
   @if (Model.Reviews.Any())
            {
          <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
      <h4 class="mb-4">
         <i class="fas fa-star me-2 text-primary"></i>التقييمات (@reviewCount)
             </h4>

   @foreach (var review in Model.Reviews.OrderByDescending(r => r.CreatedAt).Take(5))
 {
            <div class="review-item mb-4 pb-4 border-bottom">
         <div class="d-flex justify-content-between align-items-start mb-2">
   <div>
        <h6 class="mb-1">عميل</h6>
             <div class="rating-stars">
         @for (int i = 1; i <= 5; i++)
     {
                   if (i <= review.Rating)
     {
         <i class="fas fa-star text-warning"></i>
         }
             else
            {
  <i class="far fa-star text-warning"></i>
                 }
                  }
    </div>
     </div>
   <small class="text-muted">@review.CreatedAt.ToString("dd/MM/yyyy")</small>
          </div>
   <p class="text-muted mb-0">@review.Comment</p>
     </div>
           }

              @if (reviewCount > 5)
            {
            <div class="text-center">
              <button class="btn btn-outline-primary">
   عرض جميع التقييمات
</button>
        </div>
  }
             </div>
      </div>
         }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
    <!-- Quick Info -->
 <div class="card border-0 shadow-sm mb-4 sticky-top" style="top: 20px;">
     <div class="card-body p-4">
         <h5 class="mb-4">معلومات سريعة</h5>

           <div class="info-item mb-3">
       <div class="d-flex align-items-center mb-2">
         <i class="fas fa-map-marker-alt text-primary me-2"></i>
         <strong>العنوان</strong>
            </div>
      <p class="text-muted mb-0 ms-4">@Model.Address, @Model.City</p>
             </div>

   @if (Model.ExperienceYears.HasValue)
         {
             <div class="info-item mb-3">
      <div class="d-flex align-items-center mb-2">
        <i class="fas fa-award text-primary me-2"></i>
      <strong>سنوات الخبرة</strong>
         </div>
         <p class="text-muted mb-0 ms-4">@Model.ExperienceYears سنة</p>
      </div>
         }

 @if (!string.IsNullOrWhiteSpace(Model.PricingRange))
   {
              <div class="info-item mb-3">
      <div class="d-flex align-items-center mb-2">
      <i class="fas fa-money-bill-wave text-primary me-2"></i>
               <strong>نطاق الأسعار</strong>
       </div>
          <p class="text-muted mb-0 ms-4">@Model.PricingRange</p>
   </div>
          }

            <div class="info-item mb-3">
           <div class="d-flex align-items-center mb-2">
  <i class="fas fa-concierge-bell text-primary me-2"></i>
             <strong>عدد الخدمات</strong>
      </div>
   <p class="text-muted mb-0 ms-4">@Model.TailorServices.Count خدمة</p>
   </div>

                    <div class="info-item">
  <div class="d-flex align-items-center mb-2">
    <i class="fas fa-images text-primary me-2"></i>
       <strong>معرض الأعمال</strong>
     </div>
         <p class="text-muted mb-0 ms-4">@Model.PortfolioImages.Count صورة</p>
  </div>

    <hr class="my-4" />

              @if (User.Identity?.IsAuthenticated == true && User.IsInRole("Customer"))
     {
 <button class="btn btn-primary w-100 mb-2">
       <i class="fas fa-envelope me-2"></i>إرسال رسالة
     </button>
   <button class="btn btn-outline-primary w-100">
     <i class="fas fa-phone me-2"></i>طلب اتصال
 </button>
         }
     else
        {
 <a asp-controller="Account" asp-action="Login" class="btn btn-primary w-100">
                 <i class="fas fa-sign-in-alt me-2"></i>سجل دخول للتواصل
      </a>
            }
          </div>
            </div>

       <!-- Safety Tips -->
  <div class="card border-0 shadow-sm bg-light">
                <div class="card-body p-4">
            <h6 class="mb-3">
    <i class="fas fa-shield-alt text-primary me-2"></i>نصائح السلامة
         </h6>
       <ul class="list-unstyled mb-0 small text-muted">
    <li class="mb-2">
    <i class="fas fa-check text-success me-2"></i>
    تحقق من تقييمات العملاء السابقين
             </li>
       <li class="mb-2">
            <i class="fas fa-check text-success me-2"></i>
       اطلب عينات من الأعمال السابقة
    </li>
              <li class="mb-2">
         <i class="fas fa-check text-success me-2"></i>
             اتفق على السعر والمدة قبل البدء
  </li>
    <li>
 <i class="fas fa-check text-success me-2"></i>
      استخدم نظام الدفع الآمن في المنصة
      </li>
  </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
<style>
    .service-item {
      transition: all 0.3s ease;
        background: #f8f9fa;
    }

    .service-item:hover {
        transform: translateY(-3px);
   box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .portfolio-item {
      overflow: hidden;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .portfolio-item:hover {
transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .review-item:last-child {
        border-bottom: none !important;
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
    }

    .info-item {
        padding-bottom: 1rem;
    border-bottom: 1px solid #e9ecef;
    }

    .info-item:last-of-type {
      border-bottom: none;
        padding-bottom: 0;
    }
</style>
}
