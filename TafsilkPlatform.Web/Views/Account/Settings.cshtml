@model TafsilkPlatform.Web.ViewModels.AccountSettingsViewModel

@{
    ViewData["Title"] = "إعدادات الحساب";
}

@section Styles {
    <style>
 .settings-page {
    background-color: var(--background-gray);
       min-height: calc(100vh - 200px);
padding: var(--spacing-3xl) 0;
 }

        .settings-container {
     max-width: 1000px;
     margin: 0 auto;
    }

    .page-header {
margin-bottom: var(--spacing-2xl);
 }

    .page-title {
    font-size: var(--font-size-3xl);
      font-weight: 700;
     color: var(--text-primary);
       margin-bottom: var(--spacing-sm);
      }

   .page-subtitle {
        color: var(--text-secondary);
            font-size: var(--font-size-base);
        }

  .card {
 background: var(--background-white);
       border: 1px solid var(--border-color);
   border-radius: var(--radius-lg);
     padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
         box-shadow: var(--shadow-sm);
   }

        .card-header-custom {
  display: flex;
   align-items: center;
   gap: var(--spacing-sm);
     margin-bottom: var(--spacing-lg);
          padding-bottom: var(--spacing-md);
 border-bottom: 2px solid var(--border-color);
}

      .card-header-custom i {
    color: var(--primary-color);
        font-size: 1.5rem;
      }

 .card-title {
          font-size: var(--font-size-xl);
         font-weight: 700;
       color: var(--text-primary);
  margin: 0;
     }

 .form-group {
 margin-bottom: 1.25rem;
}

        .form-label {
       display: block;
       margin-bottom: 0.5rem;
  font-weight: 600;
       color: var(--text-primary);
        font-size: 0.95rem;
 }

        .form-control {
            width: 100%;
     padding: 0.875rem 1rem;
     border: 1px solid var(--border-color);
   border-radius: var(--radius-md);
       font-size: 1rem;
            transition: all 0.2s;
  font-family: var(--font-family);
    }

     .form-control:focus {
    outline: none;
            border-color: var(--primary-color);
   box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
  }

      .form-control:disabled,
      .form-control[readonly] {
            background-color: var(--background-light);
 cursor: not-allowed;
  }

   .form-text {
            font-size: 0.85rem;
color: var(--text-secondary);
       margin-top: 0.25rem;
          display: block;
   }

 .form-check {
     display: flex;
    align-items: center;
   gap: var(--spacing-sm);
 padding: var(--spacing-sm) 0;
   }

 .form-check-input {
     width: 20px;
       height: 20px;
   cursor: pointer;
        }

    .form-check-label {
      font-size: 0.95rem;
     color: var(--text-primary);
     cursor: pointer;
            margin: 0;
        }

        .section-divider {
        height: 1px;
         background: var(--border-color);
 margin: var(--spacing-xl) 0;
 }

    .section-subtitle {
  font-size: var(--font-size-lg);
 font-weight: 600;
        color: var(--text-primary);
   margin-bottom: var(--spacing-md);
    }

    .btn-group {
    display: flex;
 gap: var(--spacing-md);
     margin-top: var(--spacing-lg);
        }

      .btn-primary {
    background-color: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
     border: none;
   border-radius: var(--radius-md);
    font-weight: 600;
      cursor: pointer;
    transition: all 0.2s;
        }

    .btn-primary:hover {
  background-color: var(--primary-hover);
     transform: translateY(-2px);
    box-shadow: var(--shadow-md);
        }

   .btn-warning {
       background-color: var(--warning-color);
        color: white;
   padding: 0.75rem 1.5rem;
   border: none;
     border-radius: var(--radius-md);
  font-weight: 600;
            cursor: pointer;
       transition: all 0.2s;
     text-decoration: none;
      display: inline-block;
    }

        .btn-warning:hover {
     background-color: var(--secondary-hover);
          transform: translateY(-2px);
            box-shadow: var(--shadow-md);
     color: white;
        }

        .alert {
    padding: 1rem 1.25rem;
     margin-bottom: var(--spacing-lg);
  border-radius: var(--radius-md);
         position: relative;
 }

.alert-success {
        background-color: #d4edda;
  border: 1px solid #c3e6cb;
     color: #155724;
    }

        .btn-close {
  position: absolute;
         top: 50%;
      left: 1rem;
          transform: translateY(-50%);
 background: transparent;
   border: none;
   font-size: 1.2rem;
    cursor: pointer;
     padding: 0;
width: 20px;
        height: 20px;
            opacity: 0.5;
     }

 .btn-close:hover {
          opacity: 1;
        }

        .tips-list {
     list-style: none;
     padding: 0;
        margin: 0;
  }

.tips-list li {
            padding: var(--spacing-sm) 0;
color: var(--text-secondary);
     display: flex;
       align-items: start;
     gap: var(--spacing-sm);
  }

   .tips-list li::before {
 content: "✓";
      color: var(--success-color);
    font-weight: bold;
          font-size: 1.2rem;
   }

  .security-info {
      background: var(--background-light);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
       margin-bottom: var(--spacing-md);
         display: flex;
      align-items: start;
       gap: var(--spacing-md);
   }

     .security-info i {
  color: var(--warning-color);
      font-size: 1.5rem;
 }

   .text-danger {
color: var(--error-color);
      font-size: 0.85rem;
          margin-top: 0.25rem;
  display: block;
        }

/* Profile Picture Upload */
 .profile-picture-section {
    text-align: center;
  margin-bottom: var(--spacing-xl);
   }

 .profile-picture-preview {
   width: 150px;
  height: 150px;
      border-radius: 50%;
 object-fit: cover;
     border: 4px solid var(--border-color);
    margin-bottom: var(--spacing-md);
        }

.profile-picture-placeholder {
    width: 150px;
      height: 150px;
   border-radius: 50%;
      background: var(--background-light);
      display: flex;
  align-items: center;
      justify-content: center;
  border: 4px solid var(--border-color);
 margin: 0 auto var(--spacing-md) auto;
   }

  .profile-picture-placeholder i {
        font-size: 4rem;
 color: var(--text-secondary);
    }

   .file-input-wrapper {
      position: relative;
      display: inline-block;
   }

.file-input-wrapper input[type="file"] {
   display: none;
}

     .btn-file-upload {
 background: var(--primary-color);
      color: white;
      padding: 0.5rem 1.5rem;
      border-radius: var(--radius-md);
   cursor: pointer;
   display: inline-block;
   transition: all 0.2s;
      font-weight: 600;
    }

     .btn-file-upload:hover {
   background: var(--primary-hover);
       transform: translateY(-2px);
   }

   /* Role Badge */
   .role-badge {
 display: inline-block;
     padding: 0.25rem 0.75rem;
   border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 600;
  margin-right: 0.5rem;
  }

    .role-badge-customer {
       background: #e3f2fd;
    color: #1976d2;
        }

   .role-badge-tailor {
     background: #fff3e0;
   color: #f57c00;
  }

  .role-badge-corporate {
            background: #f3e5f5;
     color: #7b1fa2;
   }

        @@media (max-width: 768px) {
            .settings-page {
       padding: var(--spacing-xl) var(--spacing-md);
       }

.card {
             padding: var(--spacing-lg);
            }

 .btn-group {
    flex-direction: column;
  }

      .btn-primary,
  .btn-warning {
       width: 100%;
            }
     }
  </style>
}

<div class="settings-page">
    <div class="container settings-container">
  <div class="page-header">
 <h1 class="page-title">إعدادات الحساب</h1>
        <p class="page-subtitle">قم بإدارة معلوماتك الشخصية وتفضيلات الإشعارات</p>
     </div>

    @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="إغلاق">×</button>
          </div>
   }

 <div class="row">
      <div class="col-lg-8">
        <!-- Profile Information Card -->
       <div class="card">
   <div class="card-header-custom">
       <i class="fas fa-user-circle"></i>
    <h2 class="card-title">معلومات الملف الشخصي</h2>
      </div>

  <!-- Profile Picture Section -->
     <div class="profile-picture-section">
       @if (!string.IsNullOrEmpty(Model.ProfilePictureUrl))
       {
           <img src="@Model.ProfilePictureUrl" alt="الصورة الشخصية" class="profile-picture-preview" id="profilePicturePreview" />
     }
              else
    {
     <div class="profile-picture-placeholder">
   <i class="fas fa-user"></i>
      </div>
     <img src="#" alt="الصورة الشخصية" class="profile-picture-preview" id="profilePicturePreview" style="display: none;" />
   }
       </div>

     <form asp-action="Settings" method="post" enctype="multipart/form-data">
  @Html.AntiForgeryToken()
     <input type="hidden" asp-for="ProfilePictureUrl" />
    <input type="hidden" asp-for="CurrentRole" />
  <input type="hidden" asp-for="CurrentRoleId" />

 <!-- Profile Picture Upload -->
       <div class="form-group">
      <label class="form-label">تحميل صورة شخصية جديدة</label>
       <div class="file-input-wrapper">
        <label for="profilePictureFile" class="btn-file-upload">
    <i class="fas fa-camera me-2"></i>
 اختر صورة
    </label>
 <input type="file" 
          id="profilePictureFile" 
        name="ProfilePictureFile"
      accept="image/*"
     onchange="previewProfilePicture(this)" />
            </div>
        <small class="form-text">
  الصيغ المدعومة: JPG, PNG, GIF, WEBP. الحد الأقصى: 5 ميجابايت
  </small>
      <span asp-validation-for="ProfilePictureFile" class="text-danger"></span>
    </div>

 <!-- Current Role Display -->
  <div class="form-group">
      <label class="form-label">الدور الحالي</label>
  <div>
<span class="role-badge role-badge-@Model.CurrentRole.ToLower()">
  @(Model.CurrentRole == "Customer" ? "عميل" : Model.CurrentRole == "Tailor" ? "خياط" : "شركة")
      </span>
   @if (Model.CanChangeRole && Model.CurrentRole == "Customer")
     {
 <a asp-action="RequestRoleChange" class="btn-warning" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
         <i class="fas fa-exchange-alt me-2"></i>
   طلب التحويل إلى خياط
 </a>
       }
      </div>
     </div>

  <div class="form-group">
    <label asp-for="Email" class="form-label">البريد الإلكتروني</label>
       <input asp-for="Email" class="form-control" readonly />
       <small class="form-text">لا يمكن تغيير البريد الإلكتروني</small>
<span asp-validation-for="Email" class="text-danger"></span>
            </div>

    <div class="form-group">
  <label asp-for="FullName" class="form-label">الاسم الكامل</label>
   <input asp-for="FullName" class="form-control" placeholder="أدخل اسمك الكامل" />
        <span asp-validation-for="FullName" class="text-danger"></span>
   </div>

      <div class="form-group">
  <label asp-for="PhoneNumber" class="form-label">رقم الهاتف</label>
      <input asp-for="PhoneNumber" class="form-control" placeholder="أدخل رقم هاتفك" />
      <span asp-validation-for="PhoneNumber" class="text-danger"></span>
           </div>

       @if (Model.CurrentRole == "Tailor")
     {
     <div class="section-divider"></div>
    <h3 class="section-subtitle">
   <i class="fas fa-store me-2"></i>
   معلومات المتجر
 </h3>

     <div class="form-group">
        <label asp-for="ShopName" class="form-label">اسم المتجر</label>
       <input asp-for="ShopName" class="form-control" placeholder="أدخل اسم المتجر" />
     <span asp-validation-for="ShopName" class="text-danger"></span>
 </div>

           <div class="form-group">
       <label asp-for="Address" class="form-label">العنوان</label>
 <input asp-for="Address" class="form-control" placeholder="أدخل عنوان المتجر" />
  <span asp-validation-for="Address" class="text-danger"></span>
    </div>

         <div class="form-group">
         <label asp-for="City" class="form-label">المدينة</label>
          <input asp-for="City" class="form-control" placeholder="أدخل اسم المدينة" />
<span asp-validation-for="City" class="text-danger"></span>
   </div>

          <div class="form-group">
      <label asp-for="ExperienceYears" class="form-label">سنوات الخبرة</label>
 <input asp-for="ExperienceYears" class="form-control" type="number" min="0" placeholder="عدد سنوات الخبرة" />
       <span asp-validation-for="ExperienceYears" class="text-danger"></span>
      </div>

      <div class="form-group">
       <label asp-for="PricingRange" class="form-label">نطاق الأسعار</label>
         <input asp-for="PricingRange" class="form-control" placeholder="مثال: 100-500 ريال" />
  <span asp-validation-for="PricingRange" class="text-danger"></span>
   </div>

        <div class="form-group">
      <label asp-for="Bio" class="form-label">نبذة عني</label>
  <textarea asp-for="Bio" class="form-control" rows="4" placeholder="اكتب نبذة عن خبرتك وخدماتك"></textarea>
     <span asp-validation-for="Bio" class="text-danger"></span>
 </div>
      }

     @if (Model.CurrentRole == "Customer")
     {
      <div class="section-divider"></div>
        <h3 class="section-subtitle">
   <i class="fas fa-user me-2"></i>
   معلومات إضافية
             </h3>

 <div class="form-group">
   <label asp-for="City" class="form-label">المدينة</label>
    <input asp-for="City" class="form-control" placeholder="أدخل اسم المدينة" />
      <span asp-validation-for="City" class="text-danger"></span>
     </div>

     <div class="form-group">
     <label asp-for="Gender" class="form-label">الجنس</label>
    <select asp-for="Gender" class="form-control">
   <option value="">اختر...</option>
        <option value="Male">ذكر</option>
          <option value="Female">أنثى</option>
           </select>
  <span asp-validation-for="Gender" class="text-danger"></span>
    </div>

        <div class="form-group">
  <label asp-for="DateOfBirth" class="form-label">تاريخ الميلاد</label>
         <input asp-for="DateOfBirth" class="form-control" type="date" />
       <span asp-validation-for="DateOfBirth" class="text-danger"></span>
     </div>

            <div class="form-group">
<label asp-for="Bio" class="form-label">نبذة عني</label>
      <textarea asp-for="Bio" class="form-control" rows="3" placeholder="اكتب نبذة عن نفسك"></textarea>
     <span asp-validation-for="Bio" class="text-danger"></span>
   </div>
            }

        <div class="section-divider"></div>

         <h3 class="section-subtitle">
    <i class="fas fa-bell me-2"></i>
      تفضيلات الإشعارات
  </h3>

 <div class="form-check">
     <input asp-for="EmailNotifications" class="form-check-input" type="checkbox" />
        <label asp-for="EmailNotifications" class="form-check-label">
     إشعارات البريد الإلكتروني
     </label>
 </div>

   <div class="form-check">
  <input asp-for="SmsNotifications" class="form-check-input" type="checkbox" />
<label asp-for="SmsNotifications" class="form-check-label">
 إشعارات الرسائل النصية
        </label>
        </div>

        <div class="form-check">
           <input asp-for="PromotionalNotifications" class="form-check-input" type="checkbox" />
 <label asp-for="PromotionalNotifications" class="form-check-label">
         الإشعارات الترويجية والعروض
</label>
      </div>

  <div class="btn-group">
      <button type="submit" class="btn-primary">
<i class="fas fa-save me-2"></i>
 حفظ التغييرات
    </button>
   </div>
    </form>
                </div>

  <!-- Security Card -->
 <div class="card">
   <div class="card-header-custom">
     <i class="fas fa-shield-alt"></i>
   <h2 class="card-title">الأمان</h2>
           </div>

        <div class="security-info">
 <i class="fas fa-lock"></i>
         <div>
     <strong>كلمة المرور</strong>
 <p style="margin: 0.25rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">
   قم بتغيير كلمة المرور الخاصة بك للحفاظ على أمان حسابك
  </p>
  </div>
           </div>

 <a asp-action="ChangePassword" class="btn-warning">
         <i class="fas fa-key me-2"></i>
    تغيير كلمة المرور
   </a>
     </div>
            </div>

   <div class="col-lg-4">
    <!-- Tips Card -->
      <div class="card">
   <div class="card-header-custom">
        <i class="fas fa-lightbulb"></i>
         <h2 class="card-title">نصائح</h2>
    </div>

        <ul class="tips-list">
      <li>احتفظ بمعلوماتك الشخصية محدثة دائماً</li>
           <li>استخدم صورة واضحة لملفك الشخصي</li>
      <li>أكمل جميع المعلومات لزيادة مصداقيتك</li>
       <li>قم بتغيير كلمة المرور بانتظام</li>
   <li>تأكد من تفعيل الإشعارات المهمة</li>
     <li>راجع إعدادات الخصوصية بشكل دوري</li>
  </ul>
      </div>
     </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
       function previewProfilePicture(input) {
         if (input.files && input.files[0]) {
      var reader = new FileReader();
                
         reader.onload = function (e) {
       var preview = document.getElementById('profilePicturePreview');
          var placeholder = document.querySelector('.profile-picture-placeholder');

               if (preview) {
       preview.src = e.target.result;
     preview.style.display = 'block';
     }
        
            if (placeholder) {
  placeholder.style.display = 'none';
       }
             };
            
 reader.readAsDataURL(input.files[0]);
          }
        }
    </script>
}