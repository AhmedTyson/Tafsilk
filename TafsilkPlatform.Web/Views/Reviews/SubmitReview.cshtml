@model TafsilkPlatform.Web.ViewModels.Reviews.SubmitReviewRequest

@{
    ViewData["Title"] = "تقييم الخدمة | تفصيلك";
    Layout = "~/Views/Shared/_Layout.cshtml";
 var order = ViewBag.Order as TafsilkPlatform.Web.Models.Order;
    var tailor = ViewBag.Tailor as TafsilkPlatform.Web.Models.TailorProfile;
}

@section Styles {
    <style>
        .submit-review-page {
            max-width: 800px;
   margin: 40px auto;
   padding: 20px;
      }

        .review-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
       color: white;
          padding: 30px;
            border-radius: 12px;
 margin-bottom: 30px;
       }

        .review-header h1 {
 font-size: 2rem;
  margin-bottom: 10px;
        }

     .order-info {
            display: flex;
   gap: 20px;
 align-items: center;
       margin-top: 15px;
        }

.order-badge {
       background: rgba(255,255,255,0.2);
 padding: 8px 16px;
            border-radius: 20px;
 display: inline-flex;
    align-items: center;
            gap: 8px;
      }

        .review-form {
background: white;
  padding: 40px;
  border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

     .form-section {
 margin-bottom: 35px;
      }

        .section-title {
  font-size: 1.3rem;
  color: #2c3e50;
 margin-bottom: 20px;
        padding-bottom: 10px;
       border-bottom: 2px solid #e0e0e0;
     }

        .rating-input {
    display: flex;
    flex-direction: column;
  gap: 15px;
        }

     .rating-row {
            display: flex;
   justify-content: space-between;
       align-items: center;
     padding: 15px;
    background: #f8f9fa;
  border-radius: 8px;
        }

        .rating-label {
font-weight: 600;
   color: #2c3e50;
        }

   .star-rating {
 display: flex;
       gap: 5px;
       }

   .star-rating i {
       font-size: 2rem;
            cursor: pointer;
   color: #ddd;
      transition: all 0.2s;
        }

     .star-rating i:hover,
 .star-rating i.active {
       color: #f39c12;
 transform: scale(1.1);
        }

.form-group {
margin-bottom: 25px;
        }

        .form-group label {
       display: block;
   font-weight: 600;
     margin-bottom: 8px;
       color: #2c3e50;
      }

 .form-control {
  width: 100%;
      padding: 12px 15px;
       border: 2px solid #e0e0e0;
 border-radius: 8px;
         font-size: 1rem;
font-family: inherit;
       transition: border-color 0.3s;
      }

        .form-control:focus {
   outline: none;
       border-color: #667eea;
        }

    textarea.form-control {
 min-height: 150px;
     resize: vertical;
        }

        .char-counter {
       text-align: left;
       color: #7f8c8d;
    font-size: 0.9rem;
    margin-top: 5px;
   }

    .btn-submit {
            width: 100%;
padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
         border-radius: 8px;
     font-size: 1.1rem;
   font-weight: 600;
   cursor: pointer;
     transition: transform 0.2s;
     }

        .btn-submit:hover {
       transform: translateY(-2px);
        }

        .btn-submit:disabled {
   opacity: 0.6;
     cursor: not-allowed;
        }

   .guidelines {
     background: #e8f4f8;
        border-right: 4px solid #3498db;
  padding: 20px;
       border-radius: 8px;
     margin-bottom: 30px;
        }

.guidelines h3 {
   color: #2c3e50;
      margin-bottom: 10px;
        }

        .guidelines ul {
            margin: 10px 0 0 25px;
     color: #555;
   line-height: 1.8;
 }

        .text-danger {
       color: #e74c3c;
   font-size: 0.875rem;
            margin-top: 5px;
      display: block;
      }
    </style>
}

<main class="submit-review-page">
    <!-- Header -->
    <div class="review-header">
 <h1>تقييم الخدمة</h1>
    <p>شاركنا رأيك في الخدمة المقدمة من @(tailor?.ShopName ?? "الخياط")</p>
        @if (order != null)
        {
    <div class="order-info">
       <span class="order-badge">
          <i class="fas fa-file-alt"></i>
طلب رقم: #@order.OrderId.ToString().Substring(0, 8).ToUpper()
   </span>
     <span class="order-badge">
          <i class="fas fa-calendar"></i>
       @order.CreatedAt.ToString("dd/MM/yyyy")
   </span>
     </div>
  }
    </div>

    <!-- Guidelines -->
    <div class="guidelines">
        <h3><i class="fas fa-info-circle"></i> إرشادات التقييم</h3>
        <ul>
   <li>كن صادقاً وموضوعياً في تقييمك</li>
         <li>قيّم جودة العمل والتواصل والالتزام بالمواعيد</li>
  <li>اذكر نقاط القوة والضعف بشكل بناء</li>
        <li>تجنب استخدام لغة غير لائقة</li>
        </ul>
    </div>

    <!-- Review Form -->
    @using (Html.BeginForm("SubmitReview", "Reviews", FormMethod.Post, new { @class = "review-form", id = "reviewForm" }))
    {
  @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.OrderId)
        @Html.HiddenFor(m => m.TailorId)

    @if (!ViewData.ModelState.IsValid)
        {
    <div class="alert alert-danger" role="alert">
 <i class="fas fa-exclamation-circle"></i>
       <strong>يرجى تصحيح الأخطاء التالية:</strong>
    @Html.ValidationSummary(false, "", new { @class = "text-danger" })
  </div>
}

        <!-- Overall Rating -->
        <div class="form-section">
   <h3 class="section-title">التقييم العام</h3>
            <div class="rating-row">
       <span class="rating-label">تقييمك الإجمالي</span>
   <div class="star-rating" data-rating="overallRating">
     @for (int i = 1; i <= 5; i++)
       {
     <i class="far fa-star" data-value="@i"></i>
       }
                </div>
 </div>
          @Html.HiddenFor(m => m.Rating, new { id = "overallRating" })
     @Html.ValidationMessageFor(m => m.Rating, "", new { @class = "text-danger" })
        </div>

        <!-- Detailed Ratings -->
  <div class="form-section">
       <h3 class="section-title">تقييم تفصيلي</h3>
            <div class="rating-input">
 <div class="rating-row">
      <span class="rating-label">جودة العمل</span>
        <div class="star-rating" data-rating="qualityRating">
          @for (int i = 1; i <= 5; i++)
      {
     <i class="far fa-star" data-value="@i"></i>
            }
     </div>
    </div>
           @Html.HiddenFor(m => m.QualityRating, new { id = "qualityRating" })

   <div class="rating-row">
        <span class="rating-label">التواصل والاستجابة</span>
        <div class="star-rating" data-rating="communicationRating">
     @for (int i = 1; i <= 5; i++)
       {
      <i class="far fa-star" data-value="@i"></i>
         }
       </div>
   </div>
   @Html.HiddenFor(m => m.CommunicationRating, new { id = "communicationRating" })

     <div class="rating-row">
 <span class="rating-label">الالتزام بالمواعيد</span>
    <div class="star-rating" data-rating="timelinessRating">
    @for (int i = 1; i <= 5; i++)
         {
       <i class="far fa-star" data-value="@i"></i>
 }
      </div>
  </div>
@Html.HiddenFor(m => m.TimelinessRating, new { id = "timelinessRating" })

   <div class="rating-row">
   <span class="rating-label">الاحترافية</span>
       <div class="star-rating" data-rating="professionalismRating">
         @for (int i = 1; i <= 5; i++)
       {
        <i class="far fa-star" data-value="@i"></i>
         }
</div>
   </div>
     @Html.HiddenFor(m => m.ProfessionalismRating, new { id = "professionalismRating" })
       </div>
   </div>

        <!-- Written Review -->
        <div class="form-section">
  <h3 class="section-title">تعليقك</h3>
            <div class="form-group">
    <label asp-for="Comment">
  شاركنا تجربتك (اختياري)
                </label>
  @Html.TextAreaFor(m => m.Comment, new { 
        @class = "form-control", 
       placeholder = "اكتب تعليقك هنا... ماذا أعجبك؟ ما الذي يمكن تحسينه؟",
         maxlength = "1000",
    id = "commentText"
     })
     <div class="char-counter">
    <span id="charCount">0</span> / 1000 حرف
    </div>
     @Html.ValidationMessageFor(m => m.Comment, "", new { @class = "text-danger" })
      </div>
        </div>

 <button type="submit" class="btn-submit" id="submitBtn">
    <i class="fas fa-paper-plane" style="margin-left: 8px;"></i>
            <span>إرسال التقييم</span>
        </button>
    }
</main>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
       const form = document.getElementById('reviewForm');
     const submitBtn = document.getElementById('submitBtn');
    const commentText = document.getElementById('commentText');
     const charCount = document.getElementById('charCount');

  // Star Rating Functionality
       document.querySelectorAll('.star-rating').forEach(ratingGroup => {
       const ratingName = ratingGroup.getAttribute('data-rating');
  const hiddenInput = document.getElementById(ratingName);
     const stars = ratingGroup.querySelectorAll('i');

        stars.forEach((star, index) => {
   star.addEventListener('click', function () {
             const value = parseInt(this.getAttribute('data-value'));
        hiddenInput.value = value;

             // Update star display
             stars.forEach((s, i) => {
    if (i < value) {
            s.classList.remove('far');
         s.classList.add('fas', 'active');
       } else {
      s.classList.remove('fas', 'active');
          s.classList.add('far');
                }
             });
  });

   // Hover effect
     star.addEventListener('mouseenter', function () {
       const value = parseInt(this.getAttribute('data-value'));
    stars.forEach((s, i) => {
    if (i < value) {
   s.classList.add('active');
      } else {
           s.classList.remove('active');
    }
      });
           });
            });

 // Reset hover effect
      ratingGroup.addEventListener('mouseleave', function () {
      const currentValue = parseInt(hiddenInput.value) || 0;
     stars.forEach((s, i) => {
      if (i < currentValue) {
         s.classList.add('active');
       } else {
     s.classList.remove('active');
   }
           });
         });
          });

   // Character Counter
            if (commentText && charCount) {
          commentText.addEventListener('input', function () {
     charCount.textContent = this.value.length;
                });
      }

    // Form Validation
       form.addEventListener('submit', function (e) {
    const overallRating = document.getElementById('overallRating').value;

   if (!overallRating || overallRating == '0') {
           e.preventDefault();
  alert('يرجى تحديد التقييم الإجمالي');
        return false;
   }

       // Show loading state
      submitBtn.disabled = true;
     submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-left: 8px;"></i> جاري الإرسال...';
            });
        });
    </script>
}
