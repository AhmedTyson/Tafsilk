@model TafsilkPlatform.Web.ViewModels.UserSettingsViewModel
@{
 ViewData["Title"] = "إعدادات المستخدم";
}

<div class="container mt-4">
 <div class="row">
 <div class="col-12">
 <h1 class="mb-4">@ViewData["Title"]</h1>
 
 @if (TempData["Success"] != null)
 {
 <div class="alert alert-success alert-dismissible fade show" role="alert">
 @TempData["Success"]
 <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
 </div>
 }
 
 @if (TempData["Error"] != null)
 {
 <div class="alert alert-danger alert-dismissible fade show" role="alert">
 @TempData["Error"]
 <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
 </div>
 }
 </div>
 </div>

 <div class="row">
 <div class="col-lg-3">
 <div class="card">
 <div class="card-body text-center">
 <div class="mb-3">
 @if (!string.IsNullOrEmpty(Model.ProfilePictureUrl))
 {
 <img src="@Model.ProfilePictureUrl" alt="صورة الملف الشخصي" class="rounded-circle img-fluid" style="width:150px; height:150px; object-fit: cover;">
 }
 else
 {
 <div class="rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto" style="width:150px; height:150px;">
 <i class="fas fa-user fa-3x text-secondary"></i>
 </div>
 }
 </div>
 <h5 class="card-title">@Model.FullName</h5>
 <p class="text-muted">@Model.Role</p>
 </div>
 </div>
 
 <div class="card mt-3">
 <div class="card-header">
 <h6 class="mb-0">التنقل السريع</h6>
 </div>
 <div class="list-group list-group-flush">
 <a href="#personal-info" class="list-group-item list-group-item-action">المعلومات الشخصية</a>
 <a href="#password" class="list-group-item list-group-item-action">كلمة المرور</a>
 <a href="#notifications" class="list-group-item list-group-item-action">الإشعارات</a>
 @if (Model.Role == "Tailor")
 {
 <a href="#business-info" class="list-group-item list-group-item-action">معلومات المحل</a>
 }
 @if (Model.Role == "Corporate")
 {
 <a href="#company-info" class="list-group-item list-group-item-action">معلومات الشركة</a>
 }
 </div>
 </div>
 </div>

 <div class="col-lg-9">
 <form asp-action="Edit" method="post" enctype="multipart/form-data">
 <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
 <input type="hidden" asp-for="UserId" />

 <!-- Personal Information Section -->
 <div class="card mb-4" id="personal-info">
 <div class="card-header">
 <h5 class="mb-0">المعلومات الشخصية</h5>
 </div>
 <div class="card-body">
 <div class="row">
 <div class="col-md-6 mb-3">
 <label asp-for="FullName" class="form-label"></label>
 <input asp-for="FullName" class="form-control" />
 <span asp-validation-for="FullName" class="text-danger"></span>
 </div>
 <div class="col-md-6 mb-3">
 <label asp-for="Email" class="form-label"></label>
 <input asp-for="Email" class="form-control" />
 <span asp-validation-for="Email" class="text-danger"></span>
 </div>
 </div>
 
 <div class="row">
 <div class="col-md-6 mb-3">
 <label asp-for="PhoneNumber" class="form-label"></label>
 <input asp-for="PhoneNumber" class="form-control" />
 <span asp-validation-for="PhoneNumber" class="text-danger"></span>
 </div>
 <div class="col-md-6 mb-3">
 <label asp-for="City" class="form-label"></label>
 <input asp-for="City" class="form-control" />
 <span asp-validation-for="City" class="text-danger"></span>
 </div>
 </div>
 
 <div class="row">
 <div class="col-md-6 mb-3">
 <label asp-for="DateOfBirth" class="form-label"></label>
 <input asp-for="DateOfBirth" type="date" class="form-control" />
 <span asp-validation-for="DateOfBirth" class="text-danger"></span>
 </div>
 <div class="col-md-6 mb-3">
 <label asp-for="ProfilePicture" class="form-label"></label>
 <input asp-for="ProfilePicture" type="file" class="form-control" accept="image/*" />
 <span asp-validation-for="ProfilePicture" class="text-danger"></span>
 <small class="form-text text-muted">الصيغ المسموحة: JPG, PNG, GIF. الحجم الأقصى:5MB</small>
 </div>
 </div>
 
 <div class="mb-3">
 <label asp-for="Bio" class="form-label"></label>
 <textarea asp-for="Bio" class="form-control" rows="4" placeholder="أكتب نبذة مختصرة عن نفسك..."></textarea>
 <span asp-validation-for="Bio" class="text-danger"></span>
 </div>
 </div>
 </div>

 <!-- Business Information for Tailors -->
 @if (Model.Role == "Tailor")
 {
 <div class="card mb-4" id="business-info">
 <div class="card-header">
 <h5 class="mb-0">معلومات المحل</h5>
 </div>
 <div class="card-body">
 <div class="row">
 <div class="col-md-6 mb-3">
 <label asp-for="ShopName" class="form-label"></label>
 <input asp-for="ShopName" class="form-control" />
 <span asp-validation-for="ShopName" class="text-danger"></span>
 </div>
 <div class="col-md-6 mb-3">
 <label asp-for="Address" class="form-label"></label>
 <input asp-for="Address" class="form-control" />
 <span asp-validation-for="Address" class="text-danger"></span>
 </div>
 </div>
 </div>
 </div>
 }

 <!-- Company Information for Corporate -->
 @if (Model.Role == "Corporate")
 {
 <div class="card mb-4" id="company-info">
 <div class="card-header">
 <h5 class="mb-0">معلومات الشركة</h5>
 </div>
 <div class="card-body">
 <div class="row">
 <div class="col-md-6 mb-3">
 <label asp-for="CompanyName" class="form-label"></label>
 <input asp-for="CompanyName" class="form-control" />
 <span asp-validation-for="CompanyName" class="text-danger"></span>
 </div>
 <div class="col-md-6 mb-3">
 <label asp-for="ContactPerson" class="form-label"></label>
 <input asp-for="ContactPerson" class="form-control" />
 <span asp-validation-for="ContactPerson" class="text-danger"></span>
 </div>
 </div>
 </div>
 </div>
 }

 <!-- Password Change Section -->
 <div class="card mb-4" id="password">
 <div class="card-header">
 <h5 class="mb-0">تغيير كلمة المرور</h5>
 </div>
 <div class="card-body">
 <div class="row">
 <div class="col-md-4 mb-3">
 <label asp-for="CurrentPassword" class="form-label"></label>
 <input asp-for="CurrentPassword" type="password" class="form-control" />
 <span asp-validation-for="CurrentPassword" class="text-danger"></span>
 </div>
 <div class="col-md-4 mb-3">
 <label asp-for="NewPassword" class="form-label"></label>
 <input asp-for="NewPassword" type="password" class="form-control" />
 <span asp-validation-for="NewPassword" class="text-danger"></span>
 </div>
 <div class="col-md-4 mb-3">
 <label asp-for="ConfirmNewPassword" class="form-label"></label>
 <input asp-for="ConfirmNewPassword" type="password" class="form-control" />
 <span asp-validation-for="ConfirmNewPassword" class="text-danger"></span>
 </div>
 </div>
 <small class="text-muted">اترك الحقول فارغة إذا كنت لا ترغب في تغيير كلمة المرور</small>
 </div>
 </div>

 <!-- Notifications Section -->
 <div class="card mb-4" id="notifications">
 <div class="card-header">
 <h5 class="mb-0">إعدادات الإشعارات</h5>
 </div>
 <div class="card-body">
 <div class="form-check form-switch mb-3">
 <input asp-for="EmailNotifications" class="form-check-input" type="checkbox" />
 <label asp-for="EmailNotifications" class="form-check-label"></label>
 </div>
 <div class="form-check form-switch mb-3">
 <input asp-for="SmsNotifications" class="form-check-input" type="checkbox" />
 <label asp-for="SmsNotifications" class="form-check-label"></label>
 </div>
 <div class="form-check form-switch">
 <input asp-for="PromotionalNotifications" class="form-check-input" type="checkbox" />
 <label asp-for="PromotionalNotifications" class="form-check-label"></label>
 </div>
 </div>
 </div>

 <div class="d-flex gap-2">
 <button type="submit" class="btn btn-primary">حفظ التعديلات</button>
 <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary">إلغاء</a>
 @if (!string.IsNullOrEmpty(Model.ProfilePictureUrl))
 {
 <button type="submit" formaction="@Url.Action("RemoveProfilePicture")" class="btn btn-outline-danger">حذف الصورة</button>
 }
 </div>
 </form>
 </div>
 </div>
</div>

@section Scripts {
 <partial name="_ValidationScriptsPartial" />
 <script>
 // Smooth scrolling for navigation
 document.querySelectorAll('.list-group-item').forEach(link => {
 link.addEventListener('click', function(e) {
 e.preventDefault();
 const targetId = this.getAttribute('href').substring(1);
 document.getElementById(targetId).scrollIntoView({
 behavior: 'smooth'
 });
 });
 });

 // Preview profile picture before upload
 const input = document.getElementById('ProfilePicture');
 if (input) {
 input.addEventListener('change', function(e) {
 const file = e.target.files[0];
 if (file) {
 const reader = new FileReader();
 reader.onload = function(e) {
 const img = document.querySelector('.card-body .rounded-circle');
 if (img && img.tagName === 'IMG') { img.src = e.target.result; }
 }
 reader.readAsDataURL(file);
 }
 });
 }
 </script>
}
