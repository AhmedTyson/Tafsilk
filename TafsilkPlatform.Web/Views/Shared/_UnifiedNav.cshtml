@* 
    Unified Navigation Bar - Works for both authenticated and unauthenticated users
    This partial view provides a consistent navigation experience across all pages
*@

<div class="nav-overlay" id="navOverlay"></div>

<header class="unified-header" role="banner">
    <nav class="unified-navbar" role="navigation" aria-label="التنقل الرئيسي">
     <div class="container">
            <!-- Brand Logo -->
          <a asp-controller="Home" asp-action="Index" class="navbar-brand">
       <i class="fas fa-cut brand-icon"></i>
     <span class="brand-text">تفصيلك</span>
            </a>

            <!-- Navigation Links -->
            <ul class="nav-links" id="navLinks">
    <li class="nav-item">
        <a href="@Url.Action("Index","Home")#home" class="nav-link">الرئيسية</a>
    </li>
       <li class="nav-item">
 <a href="@Url.Action("Index","Home")#how-it-works" class="nav-link">كيف تعمل المنصة</a>
            </li>
   <li class="nav-item">
       <a href="@Url.Action("Index","Home")#tailors" class="nav-link">الخياطين</a>
   </li>
    <li class="nav-item">
    <a href="@Url.Action("Index","Home")#contact" class="nav-link">تواصل معنا</a>
     </li>
       
   @* Role-specific Dashboard Links *@
     @if (User.Identity?.IsAuthenticated == true)
      {
     var role = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;
             
    @if (role == "Admin")
      {
     <li class="nav-item">
      <a asp-controller="AdminDashboard" asp-action="Index" class="nav-link nav-link-dashboard">
   <i class="fas fa-tachometer-alt"></i>
    <span>لوحة المسؤول</span>
 </a>
   </li>
  }
           else if (role == "Customer")
            {
       <li class="nav-item">
     <a asp-controller="Dashboards" asp-action="Customer" class="nav-link nav-link-dashboard">
  <i class="fas fa-tachometer-alt"></i>
   <span>لوحة التحكم</span>
      </a>
       </li>
       }
    else if (role == "Tailor")
     {
      <li class="nav-item">
    <a asp-controller="Dashboards" asp-action="Tailor" class="nav-link nav-link-dashboard">
         <i class="fas fa-tachometer-alt"></i>
    <span>لوحة التحكم</span>
    </a>
    </li>
       }
       else if (role == "Corporate")
       {
     <li class="nav-item">
    <a asp-controller="Dashboards" asp-action="Corporate" class="nav-link nav-link-dashboard">
    <i class="fas fa-tachometer-alt"></i>
       <span>لوحة التحكم</span>
               </a>
    </li>
      }
        }
            </ul>

            <!-- Navigation Actions -->
        <div class="nav-actions">
       @if (User.Identity?.IsAuthenticated == true)
         {
         @* Authenticated User Menu *@
         <div class="user-menu-wrapper">
         @* Notifications *@
   <div class="notification-badge-wrapper">
        <button class="nav-icon-btn" id="notificationBtn" aria-label="الإشعارات" title="الإشعارات">
             <i class="fas fa-bell"></i>
   <span class="notification-count">3</span>
           </button>
        </div>

   @* User Menu Dropdown *@
          <div class="user-menu">
       @{
     var fullName = User.FindFirst("FullName")?.Value 
   ?? User.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value 
 ?? User.Identity?.Name 
        ?? User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value 
                  ?? "مستخدم";
 
                var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;
       var roleText = userRole switch
    {
               "Admin" => "مسؤول النظام",
    "Tailor" => "خياط",
   "Customer" => "عميل",
          "Corporate" => "عميل مؤسسي",
              _ => "مستخدم"
              };
           }
          
        <button class="user-menu-toggle" id="userMenuToggle" aria-label="قائمة المستخدم">
                  <div class="user-avatar">
    <img src="https://ui-avatars.com/api/?name=@Uri.EscapeDataString(fullName)&background=2563eb&color=fff&bold=true" 
alt="@fullName" />
      </div>
 <div class="user-info">
                 <span class="user-name">@fullName</span>
 <span class="user-role">@roleText</span>
     </div>
     <i class="fas fa-chevron-down"></i>
           </button>

 <div class="user-menu-dropdown" id="userMenuDropdown">
 <div class="dropdown-header">
       <div class="user-avatar-large">
          <img src="https://ui-avatars.com/api/?name=@Uri.EscapeDataString(fullName)&background=2563eb&color=fff&bold=true&size=64" 
alt="@fullName" />
     </div>
     <div class="user-details">
            <strong>@fullName</strong>
             <span>@User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value</span>
   </div>
         </div>
        
     <div class="dropdown-body">
     <a asp-controller="UserSettings" asp-action="Edit" class="dropdown-item">
   <i class="fas fa-user"></i>
    <span>الملف الشخصي</span>
            </a>
<a asp-controller="UserSettings" asp-action="Index" class="dropdown-item">
       <i class="fas fa-cog"></i>
    <span>الإعدادات</span>
                 </a>
          <a href="#" class="dropdown-item">
           <i class="fas fa-question-circle"></i>
      <span>المساعدة</span>
    </a>
         </div>

              <div class="dropdown-footer">
    <form asp-controller="Account" asp-action="Logout" method="post">
  @Html.AntiForgeryToken()
 <button type="submit" class="btn-logout">
    <i class="fas fa-sign-out-alt"></i>
    <span>تسجيل الخروج</span>
   </button>
               </form>
       </div>
     </div>
          </div>
       </div>
 }
     else
            {
         @* Unauthenticated User Actions *@
            <a asp-controller="Account" asp-action="Login" class="btn btn-outline">
       <i class="fas fa-sign-in-alt"></i>
            <span>تسجيل دخول</span>
        </a>
          <a asp-controller="Account" asp-action="Register" class="btn btn-primary">
            <i class="fas fa-user-plus"></i>
    <span>انضم كخياط</span>
           </a>
    }

     @* Language Toggle *@
       <button class="lang-toggle" type="button" id="langToggle" aria-label="تبديل اللغة">
           <i class="fas fa-globe"></i>
    <span class="lang-text">EN</span>
     </button>
    </div>

  <!-- Mobile Menu Toggle -->
     <button class="mobile-menu-toggle" id="navToggle" aria-label="فتح القائمة" aria-controls="navLinks" aria-expanded="false">
         <span class="bar"></span>
      <span class="bar"></span>
    <span class="bar"></span>
     </button>
     </div>
    </nav>
</header>

@* Unified Navigation Styles *@
<style>
    /* Unified Navigation Bar Styles */
  .unified-header {
  background: #ffffff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        position: sticky;
    top: 0;
        z-index: 999;
  }

    .unified-navbar {
        padding: 0.75rem 0;
    }

.unified-navbar .container {
     display: flex;
        align-items: center;
        justify-content: space-between;
    max-width: 1200px;
margin: 0 auto;
        padding: 0 1.5rem;
    }

    /* Brand */
    .navbar-brand {
 display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
 color: #2563eb;
        font-size: 1.75rem;
 font-weight: 800;
        transition: color 0.3s;
    }

    .navbar-brand:hover {
  color: #1e40af;
    }

    .brand-icon {
        font-size: 1.5rem;
    }

    .brand-text {
    line-height: 1;
    }

    /* Navigation Links */
    .nav-links {
        display: none;
    list-style: none;
margin: 0;
        padding: 0;
 gap: 0.5rem;
    }

    .nav-link {
        padding: 0.625rem 1rem;
        color: #374151;
        text-decoration: none;
        font-weight: 600;
 border-radius: 0.5rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .nav-link:hover {
        color: #2563eb;
        background: #eff6ff;
    }

    .nav-link-dashboard {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .nav-link-dashboard:hover {
        background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
        color: white;
 }

    /* Navigation Actions */
    .nav-actions {
        display: flex;
 align-items: center;
 gap: 0.75rem;
    }

    /* Buttons */
    .btn {
   display: inline-flex;
        align-items: center;
        gap: 0.5rem;
   padding: 0.625rem 1.25rem;
        border-radius: 0.5rem;
   font-weight: 600;
        text-decoration: none;
        transition: all 0.3s;
 border: none;
     cursor: pointer;
        font-size: 0.9375rem;
    }

    .btn-outline {
        background: transparent;
        border: 2px solid #2563eb;
        color: #2563eb;
    }

    .btn-outline:hover {
        background: #2563eb;
      color: white;
    }

    .btn-primary {
        background: #2563eb;
        color: white;
    }

 .btn-primary:hover {
     background: #1e40af;
    }

    /* User Menu */
    .user-menu-wrapper {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .notification-badge-wrapper {
        position: relative;
    }

    .nav-icon-btn {
    width: 42px;
    height: 42px;
        border: none;
        background: #f3f4f6;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        color: #374151;
    }

    .nav-icon-btn:hover {
        background: #e5e7eb;
        color: #2563eb;
    }

    .notification-count {
     position: absolute;
    top: -4px;
   left: -4px;
        background: #ef4444;
        color: white;
      font-size: 0.75rem;
        font-weight: 700;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
  align-items: center;
        justify-content: center;
        border: 2px solid white;
    }

    .user-menu {
    position: relative;
    }

    .user-menu-toggle {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      padding: 0.375rem 0.75rem;
        border: 2px solid #e5e7eb;
        background: white;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .user-menu-toggle:hover {
        border-color: #2563eb;
     box-shadow: 0 4px 6px rgba(37, 99, 235, 0.1);
    }

  .user-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        overflow: hidden;
    }

    .user-avatar img {
     width: 100%;
        height: 100%;
        object-fit: cover;
    }

  .user-info {
        display: flex;
        flex-direction: column;
        text-align: right;
    }

    .user-name {
      font-weight: 600;
        color: #1f2937;
font-size: 0.9375rem;
        line-height: 1.2;
    }

    .user-role {
        font-size: 0.8125rem;
        color: #6b7280;
        line-height: 1.2;
    }

    .user-menu-dropdown {
        position: absolute;
      top: calc(100% + 0.75rem);
        left: 0;
     width: 280px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        display: none;
        z-index: 1000;
    }

    .user-menu-dropdown.show {
     display: block;
   animation: fadeInDown 0.3s ease-out;
    }

    @@keyframes fadeInDown {
        from {
  opacity: 0;
 transform: translateY(-10px);
  }
        to {
     opacity: 1;
  transform: translateY(0);
      }
    }

    .dropdown-header {
        padding: 1.25rem;
        border-bottom: 1px solid #f3f4f6;
        text-align: center;
    }

 .user-avatar-large {
        width: 64px;
        height: 64px;
  border-radius: 50%;
     overflow: hidden;
      margin: 0 auto 0.75rem;
    }

    .user-avatar-large img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .user-details {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
    }

    .user-details strong {
        font-size: 1rem;
  color: #1f2937;
    }

    .user-details span {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .dropdown-body {
  padding: 0.5rem;
    }

    .dropdown-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        color: #374151;
        text-decoration: none;
        border-radius: 0.5rem;
        transition: all 0.3s;
        font-weight: 500;
    }

    .dropdown-item:hover {
        background: #f3f4f6;
        color: #2563eb;
    }

    .dropdown-item i {
        width: 20px;
     color: #9ca3af;
    }

  .dropdown-footer {
        padding: 0.75rem;
        border-top: 1px solid #f3f4f6;
    }

    .btn-logout {
        width: 100%;
        display: flex;
  align-items: center;
     justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem;
  background: #ef4444;
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
      transition: all 0.3s;
        font-size: 0.9375rem;
    }

    .btn-logout:hover {
        background: #dc2626;
    }

    /* Language Toggle */
    .lang-toggle {
  width: 42px;
        height: 42px;
        border: none;
      background: #f3f4f6;
        border-radius: 50%;
        display: flex;
        align-items: center;
   justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
     color: #374151;
        position: relative;
    }

    .lang-toggle:hover {
        background: #e5e7eb;
        color: #2563eb;
    }

    .lang-text {
        font-size: 0.75rem;
        font-weight: 700;
        position: absolute;
    }

    /* Mobile Menu Toggle */
  .mobile-menu-toggle {
        display: none;
        flex-direction: column;
    gap: 4px;
        background: none;
    border: none;
        padding: 8px;
        cursor: pointer;
    }

    .mobile-menu-toggle .bar {
        width: 24px;
        height: 2px;
        background: #374151;
        transition: all 0.3s;
    }

    /* Navigation Overlay */
    .nav-overlay {
        display: none;
        position: fixed;
 inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        opacity: 0;
  transition: opacity 0.3s;
    }

    body.nav-open .nav-overlay {
        opacity: 1;
    }

  /* Desktop Navigation */
    @@media (min-width: 1024px) {
        .nav-links {
            display: flex;
        }
}

    /* Tablet & Mobile */
    @@media (max-width: 1023px) {
        .unified-navbar .container {
     padding: 0 1rem;
        }

        .mobile-menu-toggle {
        display: flex;
        }

        .nav-links {
     position: fixed;
            top: 0;
        left: 0;
       width: 280px;
     height: 100vh;
            background: white;
       flex-direction: column;
            padding: 2rem 1.5rem;
   box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s;
        z-index: 999;
    overflow-y: auto;
        }

        body.nav-open .nav-links {
  display: flex;
       transform: translateX(0);
        }

        body.nav-open .nav-overlay {
       display: block;
        }

    .nav-link {
   width: 100%;
            justify-content: flex-start;
        }

 .user-info {
            display: none;
        }

        .btn span {
        display: none;
        }

        .lang-toggle .lang-text {
       display: none;
        }
  }

    @@media (max-width: 640px) {
        .navbar-brand {
       font-size: 1.5rem;
        }

        .brand-icon {
         font-size: 1.25rem;
 }

   .notification-badge-wrapper {
  display: none;
        }
  }
</style>

@* Unified Navigation Script *@
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mobile menu toggle
        const navToggle = document.getElementById('navToggle');
  const navOverlay = document.getElementById('navOverlay');
        const body = document.body;

        if (navToggle) {
    navToggle.addEventListener('click', function() {
             body.classList.toggle('nav-open');
      const isExpanded = body.classList.contains('nav-open');
   navToggle.setAttribute('aria-expanded', isExpanded);
          });
        }

     if (navOverlay) {
  navOverlay.addEventListener('click', function() {
    body.classList.remove('nav-open');
 navToggle.setAttribute('aria-expanded', 'false');
      });
        }

   // User menu dropdown
     const userMenuToggle = document.getElementById('userMenuToggle');
        const userMenuDropdown = document.getElementById('userMenuDropdown');

        if (userMenuToggle && userMenuDropdown) {
 userMenuToggle.addEventListener('click', function(e) {
          e.stopPropagation();
            userMenuDropdown.classList.toggle('show');
     });

      document.addEventListener('click', function(e) {
         if (!userMenuToggle.contains(e.target) && !userMenuDropdown.contains(e.target)) {
      userMenuDropdown.classList.remove('show');
     }
  });
        }

        // Language toggle
        const langToggle = document.getElementById('langToggle');
 if (langToggle) {
 langToggle.addEventListener('click', function() {
    const langText = this.querySelector('.lang-text');
     if (langText) {
       langText.textContent = langText.textContent === 'EN' ? 'ع' : 'EN';
                }
                // Here you can add actual language switching logic
          });
        }
    });
</script>
