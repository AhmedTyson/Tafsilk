{
  "info": {
 "name": "Tafsilk Platform - Complete User Cycles",
    "_postman_id": "tafsilk-complete-cycles",
    "description": "Complete end-to-end user journeys for Customer, Tailor, and Admin",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
  {
      "key": "baseUrl",
      "value": "https://localhost:7186",
      "type": "string"
    },
    {
    "key": "customerEmail",
      "value": "customer{{$timestamp}}@test.com",
      "type": "string"
    },
    {
      "key": "tailorEmail",
      "value": "tailor{{$timestamp}}@test.com",
      "type": "string"
    },
    {
      "key": "customerToken",
 "value": "",
      "type": "string"
    },
    {
      "key": "tailorToken",
 "value": "",
 "type": "string"
    },
    {
   "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "orderId",
   "value": "",
      "type": "string"
    },
    {
      "key": "tailorId",
      "value": "",
      "type": "string"
    },
    {
      "key": "idempotencyKey",
      "value": "order-{{$timestamp}}-{{$randomUUID}}",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "01 - CUSTOMER CYCLE",
      "item": [
        {
       "name": "1.1 Register Customer",
          "event": [
            {
       "listen": "test",
      "script": {
     "exec": [
             "pm.test(\"Registration successful\", function () {",
                "    pm.response.to.have.status(200);",
        "});"
                ],
     "type": "text/javascript"
         }
   }
          ],
          "request": {
       "method": "POST",
       "header": [
  {
                "key": "Content-Type",
          "value": "application/x-www-form-urlencoded"
 }
       ],
   "body": {
       "mode": "urlencoded",
  "urlencoded": [
     {
          "key": "email",
 "value": "{{customerEmail}}",
       "type": "text"
         },
      {
            "key": "password",
       "value": "Customer@123",
        "type": "text"
     },
      {
           "key": "confirmPassword",
         "value": "Customer@123",
"type": "text"
    },
        {
   "key": "role",
    "value": "Customer",
         "type": "text"
       }
 ]
      },
            "url": {
    "raw": "{{baseUrl}}/Account/Register",
    "host": ["{{baseUrl}}"],
              "path": ["Account", "Register"]
            }
          }
        },
 {
          "name": "1.2 Login Customer (Get Token)",
          "event": [
            {
   "listen": "test",
     "script": {
   "exec": [
      "pm.test(\"Login successful\", function () {",
         "    pm.response.to.have.status(200);",
        "    var jsonData = pm.response.json();",
  "    pm.environment.set(\"customerToken\", jsonData.accessToken);",
              "});"
    ],
        "type": "text/javascript"
       }
            }
  ],
          "request": {
            "method": "POST",
            "header": [
    {
      "key": "Content-Type",
       "value": "application/json"
    }
      ],
       "body": {
  "mode": "raw",
      "raw": "{\n  \"email\": \"{{customerEmail}}\",\n  \"password\": \"Customer@123\"\n}"
            },
  "url": {
            "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
   "path": ["api", "auth", "login"]
   }
        }
    },
        {
       "name": "1.3 Complete Customer Profile",
    "request": {
       "method": "POST",
   "header": [
     {
            "key": "Authorization",
                "value": "Bearer {{customerToken}}"
      }
     ],
    "body": {
              "mode": "urlencoded",
              "urlencoded": [
         {
      "key": "fullName",
                  "value": "أحمد محمد",
    "type": "text"
    },
         {
        "key": "city",
    "value": "الرياض",
          "type": "text"
      },
             {
       "key": "phoneNumber",
           "value": "0501234567",
 "type": "text"
  },
                {
                  "key": "gender",
  "value": "Male",
        "type": "text"
  }
         ]
         },
        "url": {
    "raw": "{{baseUrl}}/Profile/CompleteCustomerProfile",
              "host": ["{{baseUrl}}"],
    "path": ["Profile", "CompleteCustomerProfile"]
   }
          }
        },
        {
          "name": "1.4 Browse Verified Tailors",
          "request": {
            "method": "GET",
            "header": [
     {
  "key": "Authorization",
     "value": "Bearer {{customerToken}}"
            }
  ],
            "url": {
         "raw": "{{baseUrl}}/Tailors/Index",
   "host": ["{{baseUrl}}"],
              "path": ["Tailors", "Index"]
       }
    }
        },
{
   "name": "1.5 Create Order (Idempotent)",
          "event": [
            {
           "listen": "test",
              "script": {
        "exec": [
      "pm.test(\"Order created successfully\", function () {",
              "    pm.response.to.have.status(200);",
    "    var jsonData = pm.response.json();",
  "    pm.expect(jsonData.success).to.be.true;",
   "    pm.environment.set(\"orderId\", jsonData.orderId);",
          "});"
            ],
      "type": "text/javascript"
      }
     }
    ],
          "request": {
            "method": "POST",
   "header": [
              {
          "key": "Content-Type",
   "value": "application/json"
      },
           {
   "key": "Authorization",
                "value": "Bearer {{customerToken}}"
       },
          {
         "key": "Idempotency-Key",
 "value": "{{idempotencyKey}}"
    }
    ],
        "body": {
       "mode": "raw",
  "raw": "{\n  \"tailorId\": \"{{tailorId}}\",\n  \"serviceType\": \"تفصيل ثوب\",\n  \"description\": \"ثوب بمقاسات خاصة - مقاس 58 - لون أبيض\",\n  \"estimatedPrice\": 250.00\n}"
     },
 "url": {
     "raw": "{{baseUrl}}/api/orders",
          "host": ["{{baseUrl}}"],
       "path": ["api", "orders"]
            }
          }
        },
        {
      "name": "1.6 Test Idempotency (Same Key)",
          "event": [
            {
  "listen": "test",
    "script": {
         "exec": [
         "pm.test(\"Same response returned\", function () {",
   "    pm.response.to.have.status(200);",
           "    var jsonData = pm.response.json();",
              " pm.expect(jsonData.orderId).to.eql(pm.environment.get(\"orderId\"));",
       "});"
            ],
      "type": "text/javascript"
     }
            }
          ],
          "request": {
            "method": "POST",
        "header": [
           {
         "key": "Content-Type",
      "value": "application/json"
              },
 {
     "key": "Authorization",
     "value": "Bearer {{customerToken}}"
              },
  {
                "key": "Idempotency-Key",
    "value": "{{idempotencyKey}}"
              }
],
 "body": {
      "mode": "raw",
              "raw": "{\n  \"tailorId\": \"{{tailorId}}\",\n  \"serviceType\": \"تفصيل ثوب\",\n  \"description\": \"ثوب بمقاسات خاصة - مقاس 58 - لون أبيض\",\n  \"estimatedPrice\": 250.00\n}"
     },
    "url": {
   "raw": "{{baseUrl}}/api/orders",
  "host": ["{{baseUrl}}"],
           "path": ["api", "orders"]
          }
          }
        },
        {
          "name": "1.7 View Order Details",
   "request": {
            "method": "GET",
     "header": [
        {
                "key": "Authorization",
        "value": "Bearer {{customerToken}}"
          }
  ],
  "url": {
   "raw": "{{baseUrl}}/Orders/OrderDetails/{{orderId}}",
            "host": ["{{baseUrl}}"],
         "path": ["Orders", "OrderDetails", "{{orderId}}"]
  }
    }
        },
        {
        "name": "1.8 Get My Notifications",
          "request": {
            "method": "GET",
          "header": [
       {
            "key": "Authorization",
         "value": "Bearer {{customerToken}}"
    }
         ],
      "url": {
"raw": "{{baseUrl}}/api/notifications",
   "host": ["{{baseUrl}}"],
     "path": ["api", "notifications"]
 }
          }
        },
        {
          "name": "1.9 Get Unread Count",
          "request": {
            "method": "GET",
    "header": [
              {
"key": "Authorization",
      "value": "Bearer {{customerToken}}"
  }
  ],
         "url": {
              "raw": "{{baseUrl}}/api/notifications/unread-count",
     "host": ["{{baseUrl}}"],
         "path": ["api", "notifications", "unread-count"]
    }
   }
        },
   {
 "name": "1.10 Submit Review",
  "request": {
"method": "POST",
      "header": [
         {
   "key": "Authorization",
        "value": "Bearer {{customerToken}}"
           }
            ],
     "body": {
      "mode": "urlencoded",
              "urlencoded": [
 {
        "key": "orderId",
     "value": "{{orderId}}",
      "type": "text"
    },
    {
          "key": "tailorId",
    "value": "{{tailorId}}",
   "type": "text"
            },
    {
      "key": "rating",
        "value": "5",
             "type": "text"
                },
         {
   "key": "comment",
         "value": "خدمة ممتازة والتفصيل احترافي",
        "type": "text"
        },
       {
   "key": "qualityRating",
                "value": "5",
 "type": "text"
    },
    {
   "key": "communicationRating",
        "value": "5",
       "type": "text"
       },
            {
   "key": "timelinessRating",
            "value": "5",
        "type": "text"
        },
      {
          "key": "professionalismRating",
      "value": "4",
      "type": "text"
 }
              ]
            },
            "url": {
        "raw": "{{baseUrl}}/Reviews/SubmitReview",
  "host": ["{{baseUrl}}"],
    "path": ["Reviews", "SubmitReview"]
     }
  }
        }
      ]
    },
    {
      "name": "02 - TAILOR CYCLE",
      "item": [
      {
          "name": "2.1 Register Tailor",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "urlencoded",
  "urlencoded": [
     {
  "key": "email",
          "value": "{{tailorEmail}}",
   "type": "text"
        },
       {
         "key": "password",
    "value": "Tailor@123",
        "type": "text"
        },
             {
                  "key": "confirmPassword",
           "value": "Tailor@123",
            "type": "text"
    },
       {
 "key": "role",
             "value": "Tailor",
    "type": "text"
       }
          ]
            },
 "url": {
            "raw": "{{baseUrl}}/Account/Register",
        "host": ["{{baseUrl}}"],
    "path": ["Account", "Register"]
         }
      }
        },
        {
          "name": "2.2 Login Tailor (Get Token)",
          "event": [
   {
        "listen": "test",
              "script": {
                "exec": [
            "pm.test(\"Login successful\", function () {",
                  "    pm.response.to.have.status(200);",
             "    var jsonData = pm.response.json();",
           "pm.environment.set(\"tailorToken\", jsonData.accessToken);",
   "});"
 ],
       "type": "text/javascript"
    }
          }
     ],
 "request": {
    "method": "POST",
   "header": [
  {
             "key": "Content-Type",
       "value": "application/json"
          }
     ],
      "body": {
           "mode": "raw",
         "raw": "{\n  \"email\": \"{{tailorEmail}}\",\n  \"password\": \"Tailor@123\"\n}"
     },
      "url": {
              "raw": "{{baseUrl}}/api/auth/login",
   "host": ["{{baseUrl}}"],
     "path": ["api", "auth", "login"]
          }
          }
        },
        {
          "name": "2.3 Complete Tailor Profile",
     "request": {
            "method": "POST",
          "header": [
      {
          "key": "Authorization",
      "value": "Bearer {{tailorToken}}"
              }
    ],
            "body": {
              "mode": "formdata",
       "formdata": [
    {
          "key": "fullName",
  "value": "محمد أحمد الخياط",
       "type": "text"
       },
        {
       "key": "shopName",
        "value": "خياطة النجاح",
          "type": "text"
     },
            {
"key": "city",
       "value": "الرياض",
        "type": "text"
    },
    {
      "key": "phoneNumber",
     "value": "0509876543",
        "type": "text"
         },
        {
   "key": "address",
       "value": "شارع الملك فهد",
            "type": "text"
             },
 {
       "key": "bio",
         "value": "خياط محترف مع 10 سنوات خبرة",
          "type": "text"
     },
 {
  "key": "pricingRange",
   "value": "100-500 ريال",
     "type": "text"
         }
    ]
            },
            "url": {
        "raw": "{{baseUrl}}/Account/CompleteTailorProfile",
      "host": ["{{baseUrl}}"],
       "path": ["Account", "CompleteTailorProfile"]
        }
          }
        },
    {
          "name": "2.4 View Received Orders",
          "request": {
  "method": "GET",
   "header": [
  {
  "key": "Authorization",
        "value": "Bearer {{tailorToken}}"
      }
            ],
    "url": {
              "raw": "{{baseUrl}}/Orders/TailorOrders",
      "host": ["{{baseUrl}}"],
           "path": ["Orders", "TailorOrders"]
  }
          }
     },
        {
    "name": "2.5 Update Order Status",
       "request": {
            "method": "POST",
            "header": [
          {
         "key": "Authorization",
    "value": "Bearer {{tailorToken}}"
          }
     ],
      "body": {
  "mode": "urlencoded",
         "urlencoded": [
                {
      "key": "orderId",
      "value": "{{orderId}}",
 "type": "text"
                },
          {
       "key": "status",
       "value": "Completed",
          "type": "text"
       }
              ]
         },
         "url": {
           "raw": "{{baseUrl}}/Orders/UpdateOrderStatus",
            "host": ["{{baseUrl}}"],
  "path": ["Orders", "UpdateOrderStatus"]
            }
          }
      },
        {
          "name": "2.6 Get Tailor Notifications",
      "request": {
 "method": "GET",
    "header": [
        {
            "key": "Authorization",
  "value": "Bearer {{tailorToken}}"
          }
          ],
 "url": {
         "raw": "{{baseUrl}}/api/notifications",
      "host": ["{{baseUrl}}"],
              "path": ["api", "notifications"]
            }
   }
        }
      ]
    },
{
      "name": "03 - ADMIN CYCLE",
      "item": [
 {
       "name": "3.1 Login Admin",
   "event": [
  {
              "listen": "test",
              "script": {
         "exec": [
      "pm.test(\"Login successful\", function () {",
       "    pm.response.to.have.status(200);",
     "    var jsonData = pm.response.json();",
          "    pm.environment.set(\"adminToken\", jsonData.accessToken);",
        "});"
             ],
       "type": "text/javascript"
              }
            }
          ],
     "request": {
            "method": "POST",
            "header": [
              {
   "key": "Content-Type",
    "value": "application/json"
         }
     ],
          "body": {
      "mode": "raw",
    "raw": "{\n  \"email\": \"admin@tafsilk.com\",\n  \"password\": \"Admin@123\"\n}"
     },
     "url": {
    "raw": "{{baseUrl}}/api/auth/login",
       "host": ["{{baseUrl}}"],
  "path": ["api", "auth", "login"]
         }
          }
        },
{
   "name": "3.2 View Dashboard",
          "request": {
            "method": "GET",
            "header": [
           {
       "key": "Authorization",
        "value": "Bearer {{adminToken}}"
    }
            ],
            "url": {
     "raw": "{{baseUrl}}/AdminDashboard/Index",
   "host": ["{{baseUrl}}"],
  "path": ["AdminDashboard", "Index"]
        }
          }
        },
        {
          "name": "3.3 View Pending Verifications",
          "request": {
     "method": "GET",
          "header": [
          {
      "key": "Authorization",
       "value": "Bearer {{adminToken}}"
              }
     ],
       "url": {
    "raw": "{{baseUrl}}/AdminDashboard/PendingVerifications",
              "host": ["{{baseUrl}}"],
        "path": ["AdminDashboard", "PendingVerifications"]
   }
        }
},
        {
          "name": "3.4 Send System Announcement",
    "request": {
        "method": "POST",
     "header": [
      {
          "key": "Content-Type",
           "value": "application/json"
         },
           {
    "key": "Authorization",
    "value": "Bearer {{adminToken}}"
              }
   ],
        "body": {
  "mode": "raw",
  "raw": "{\n  \"title\": \"تحديث النظام\",\n  \"message\": \"سيتم إجراء صيانة للنظام يوم الجمعة من الساعة 2 صباحاً حتى 4 صباحاً\",\n  \"audienceType\": \"All\",\n  \"expiresAt\": \"2024-12-31T23:59:59Z\"\n}"
},
         "url": {
        "raw": "{{baseUrl}}/api/notifications/system",
              "host": ["{{baseUrl}}"],
  "path": ["api", "notifications", "system"]
    }
          }
        }
      ]
    },
    {
      "name": "04 - IDEMPOTENCY TESTS",
      "item": [
        {
     "name": "4.1 Check Idempotency Key Status",
      "request": {
            "method": "GET",
            "header": [
          {
      "key": "Authorization",
    "value": "Bearer {{customerToken}}"
      }
    ],
   "url": {
     "raw": "{{baseUrl}}/api/orders/status/{{idempotencyKey}}",
 "host": ["{{baseUrl}}"],
    "path": ["api", "orders", "status", "{{idempotencyKey}}"]
            }
          }
        },
  {
        "name": "4.2 View All Idempotency Keys (SQL)",
      "request": {
   "method": "GET",
            "header": [],
 "url": {
      "raw": "{{baseUrl}}/sql/idempotency-keys",
              "host": ["{{baseUrl}}"],
              "path": ["sql", "idempotency-keys"]
            },
            "description": "Run SQL: SELECT * FROM IdempotencyKeys"
          }
        }
      ]
    }
  ]
}
