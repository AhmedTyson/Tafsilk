@* 
    ===================================================
  UNIFIED NAVIGATION BAR - TAFSILK PLATFORM
    ===================================================
    Modern, responsive navigation for all user types
    - Unauthenticated users
    - Customers (عميل)
    - Tailors (خياط)
  - Admins (مسؤول)
    
    Features:
    - Sticky header
    - Mobile responsive
    - User dropdown menu
    - Notifications badge
    - Language toggle
    - Role-based navigation
*@

@{
 var isAuthenticated = User.Identity?.IsAuthenticated == true;
    var userRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;
    var userName = User.FindFirst("FullName")?.Value 
                ?? User.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value 
        ?? User.Identity?.Name 
    ?? User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value 
                ?? "مستخدم";
    var userEmail = User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value ?? "";
    
    var roleDisplayName = userRole switch
    {
        "Admin" => "مسؤول النظام",
        "Tailor" => "خياط",
        "Customer" => "عميل",
        _ => "مستخدم"
    };
}

<!-- Mobile Overlay -->
<div class="taf-nav-overlay" id="tafNavOverlay"></div>

<!-- Main Navigation -->
<header class="taf-header">
 <nav class="taf-nav">
        <div class="taf-container">
  
            <!-- Logo/Brand -->
  <a href="@Url.Action("Index", "Home")" class="taf-brand">
      <i class="fas fa-cut"></i>
                <span>تفصيلك</span>
    </a>

            <!-- Main Navigation Links (Desktop) -->
    <ul class="taf-nav-links" id="tafNavLinks">
    <li><a href="@Url.Action("Index", "Home")#home" class="taf-link">الرئيسية</a></li>
           <li><a href="@Url.Action("Index", "Home")#how-it-works" class="taf-link">كيف تعمل</a></li>
     <li><a href="@Url.Action("Index", "Home")#tailors" class="taf-link">الخياطين</a></li>
    <!-- ✅ NEW: Store Link -->
           <li><a href="@Url.Action("Index", "Store")" class="taf-link">
           <i class="fas fa-store"></i> المتجر
        </a></li>
    <li><a href="@Url.Action("Index", "Home")#contact" class="taf-link">اتصل بنا</a></li>
       </ul>

   <!-- Right Actions -->
   <div class="taf-actions">
    
     <!-- ✅ NEW: Shopping Cart (for Customers only) -->
            @if (isAuthenticated && userRole == "Customer")
{
       <a href="@Url.Action("Cart", "Store")" class="taf-icon-btn" id="cartButton" title="سلة التسوق">
       <i class="fas fa-shopping-cart"></i>
      <span class="taf-badge" id="cart-badge" style="display: none;">0</span>
     </a>
  }

     @if (isAuthenticated)
    {
 <!-- Dashboard Button (Desktop Only) -->
   @if (userRole == "Admin")
        {
          <a href="@Url.Action("Index", "AdminDashboard")" class="taf-btn taf-btn-dashboard">
     <i class="fas fa-tachometer-alt"></i>
    <span>لوحة المسؤول</span>
      </a>
     }
  else if (userRole == "Customer")
{
        <a href="@Url.Action("Customer", "Dashboards")" class="taf-btn taf-btn-dashboard">
   <i class="fas fa-tachometer-alt"></i>
 <span>لوحة التحكم</span>
  </a>
         }
   else if (userRole == "Tailor")
     {
            <a href="@Url.Action("Tailor", "Dashboards")" class="taf-btn taf-btn-dashboard">
       <i class="fas fa-tachometer-alt"></i>
         <span>لوحة التحكم</span>
    </a>
       }

    <!-- User Menu -->
          <div class="taf-user-menu">
            <button class="taf-user-toggle" id="tafUserToggle">
                    <img src="https://ui-avatars.com/api/?name=@Uri.EscapeDataString(userName)&background=2563eb&color=fff&bold=true&size=40" 
  alt="@userName" class="taf-avatar" />
      <div class="taf-user-info">
       <span class="taf-user-name">@userName</span>
   <span class="taf-user-role">@roleDisplayName</span>
         </div>
      <i class="fas fa-chevron-down"></i>
          </button>

      <!-- Dropdown Menu -->
        <div class="taf-dropdown" id="tafUserDropdown">
     <!-- Header -->
           <div class="taf-dropdown-header">
   <img src="https://ui-avatars.com/api/?name=@Uri.EscapeDataString(userName)&background=2563eb&color=fff&bold=true&size=64" 
        alt="@userName" class="taf-avatar-lg" />
     <div class="taf-dropdown-user">
             <strong>@userName</strong>
                <span>@userEmail</span>
</div>
     </div>

        <!-- Body -->
                <div class="taf-dropdown-body">
         <!-- Dashboard (Mobile Only) -->
            @if (userRole == "Admin")
            {
             <a href="@Url.Action("Index", "AdminDashboard")" class="taf-dropdown-item taf-mobile-only">
       <i class="fas fa-tachometer-alt"></i>
      <span>لوحة المسؤول</span>
          </a>
   }
   else if (userRole == "Customer")
     {
  <a href="@Url.Action("Customer", "Dashboards")" class="taf-dropdown-item taf-mobile-only">
<i class="fas fa-tachometer-alt"></i>
        <span>لوحة التحكم</span>
 </a>
    }
     else if (userRole == "Tailor")
         {
            <a href="@Url.Action("Tailor", "Dashboards")" class="taf-dropdown-item taf-mobile-only">
   <i class="fas fa-tachometer-alt"></i>
        <span>لوحة التحكم</span>
    </a>
         }

  <!-- Profile Link -->
 @if (userRole == "Tailor")
        {
  <a href="@Url.Action("TailorProfile", "Profiles")" class="taf-dropdown-item">
  <i class="fas fa-user"></i>
          <span>الملف الشخصي</span>
  </a>
  }
              else if (userRole == "Customer")
                {
         <a href="@Url.Action("CustomerProfile", "Profiles")" class="taf-dropdown-item">
          <i class="fas fa-user"></i>
        <span>الملف الشخصي</span>
        </a>
      }
       else if (userRole == "Admin")
        {
         <a href="@Url.Action("Index", "AdminDashboard")" class="taf-dropdown-item">
        <i class="fas fa-user-shield"></i>
     <span>لوحة الإدارة</span>
               </a>
     }

       <!-- Settings -->
               <a href="#" class="taf-dropdown-item">
     <i class="fas fa-cog"></i>
    <span>الإعدادات</span>
         </a>

          <!-- Help -->
         <a href="@Url.Action("Privacy", "Home")" class="taf-dropdown-item">
  <i class="fas fa-question-circle"></i>
       <span>المساعدة</span>
        </a>
      </div>

    <!-- Footer -->
          <div class="taf-dropdown-footer">
        <form asp-controller="Account" asp-action="Logout" method="post">
         @Html.AntiForgeryToken()
   <button type="submit" class="taf-btn-logout">
     <i class="fas fa-sign-out-alt"></i>
             <span>تسجيل الخروج</span>
        </button>
         </form>
   </div>
        </div>
              </div>
    }
   else
    {
      <!-- Unauthenticated Actions -->
        <a href="@Url.Action("Login", "Account")" class="taf-btn taf-btn-outline">
<i class="fas fa-sign-in-alt"></i>
<span>تسجيل دخول</span>
         </a>
   <a href="@Url.Action("Register", "Account")" class="taf-btn taf-btn-primary">
   <i class="fas fa-user-plus"></i>
           <span>انضم الآن</span>
       </a>
                }

        <!-- Language Toggle -->
       <button class="taf-icon-btn" id="tafLangToggle" title="تغيير اللغة">
           <i class="fas fa-globe"></i>
    </button>

       <!-- Mobile Menu Toggle -->
       <button class="taf-menu-toggle" id="tafMenuToggle" aria-label="القائمة">
             <span></span>
            <span></span>
       <span></span>
     </button>
       </div>
        </div>
    </nav>
</header>

<!-- Styles -->
<style>
/* ===== CSS Reset & Variables ===== */
:root {
    --taf-primary: #2563eb;
    --taf-primary-dark: #1e40af;
    --taf-gray-50: #f9fafb;
    --taf-gray-100: #f3f4f6;
    --taf-gray-200: #e5e7eb;
    --taf-gray-300: #d1d5db;
    --taf-gray-400: #9ca3af;
    --taf-gray-500: #6b7280;
    --taf-gray-600: #4b5563;
    --taf-gray-700: #374151;
    --taf-gray-800: #1f2937;
    --taf-gray-900: #111827;
 --taf-red: #ef4444;
    --taf-red-dark: #dc2626;
    --taf-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
    --taf-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    --taf-radius: 0.5rem;
    --taf-transition: all 0.3s ease;
}

/* ===== Header ===== */
.taf-header {
    background: white;
    box-shadow: var(--taf-shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.taf-nav {
    padding: 1rem 0;
}

.taf-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
}

/* ===== Brand/Logo ===== */
.taf-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    color: var(--taf-primary);
  font-size: 1.75rem;
    font-weight: 800;
    transition: var(--taf-transition);
}

.taf-brand:hover {
    color: var(--taf-primary-dark);
}

.taf-brand i {
    font-size: 1.5rem;
}

/* ===== Navigation Links ===== */
.taf-nav-links {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 0.5rem;
}

.taf-link {
  display: block;
    padding: 0.625rem 1rem;
    color: var(--taf-gray-700);
    text-decoration: none;
    font-weight: 600;
    border-radius: var(--taf-radius);
    transition: var(--taf-transition);
}

.taf-link:hover {
    color: var(--taf-primary);
    background: var(--taf-gray-50);
}

/* ===== Actions Container ===== */
.taf-actions {
    display: flex;
 align-items: center;
    gap: 0.75rem;
}

/* ===== Buttons ===== */
.taf-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
border-radius: var(--taf-radius);
    font-weight: 600;
    font-size: 0.9375rem;
    text-decoration: none;
    border: none;
    cursor: pointer;
  transition: var(--taf-transition);
    white-space: nowrap;
}

.taf-btn-primary {
    background: var(--taf-primary);
    color: white;
}

.taf-btn-primary:hover {
    background: var(--taf-primary-dark);
}

.taf-btn-outline {
    background: transparent;
    border: 2px solid var(--taf-primary);
    color: var(--taf-primary);
}

.taf-btn-outline:hover {
    background: var(--taf-primary);
    color: white;
}

.taf-btn-dashboard {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.taf-btn-dashboard:hover {
    background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
}

/* ===== Icon Buttons ===== */
.taf-icon-btn {
    width: 42px;
    height: 42px;
    border: none;
    background: var(--taf-gray-100);
    border-radius: 50%;
    display: flex;
    align-items: center;
  justify-content: center;
    cursor: pointer;
    transition: var(--taf-transition);
    color: var(--taf-gray-700);
 position: relative;
}

.taf-icon-btn:hover {
    background: var(--taf-gray-200);
    color: var(--taf-primary);
}

.taf-badge {
    position: absolute;
    top: -4px;
    left: -4px;
    background: var(--taf-red);
    color: white;
    font-size: 0.75rem;
  font-weight: 700;
 width: 20px;
height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid white;
}

/* ===== User Menu ===== */
.taf-user-menu {
    position: relative;
}

.taf-user-toggle {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.375rem 0.75rem;
    border: 2px solid var(--taf-gray-200);
    background: white;
    border-radius: 50px;
    cursor: pointer;
    transition: var(--taf-transition);
}

.taf-user-toggle:hover {
    border-color: var(--taf-primary);
    box-shadow: 0 4px 6px rgba(37, 99, 235, 0.1);
}

.taf-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
  object-fit: cover;
}

.taf-user-info {
    display: flex;
    flex-direction: column;
    text-align: right;
}

.taf-user-name {
    font-weight: 600;
    color: var(--taf-gray-900);
    font-size: 0.9375rem;
    line-height: 1.2;
}

.taf-user-role {
    font-size: 0.8125rem;
    color: var(--taf-gray-500);
    line-height: 1.2;
}

/* ===== Dropdown ===== */
.taf-dropdown {
  position: absolute;
top: calc(100% + 0.75rem);
    left: 0;
    width: 280px;
    background: white;
border: 1px solid var(--taf-gray-200);
    border-radius: var(--taf-radius);
    box-shadow: var(--taf-shadow-lg);
    display: none;
    z-index: 1001;
}

.taf-dropdown.show {
    display: block;
    animation: tafFadeIn 0.3s ease-out;
}

@@keyframes tafFadeIn {
    from {
     opacity: 0;
        transform: translateY(-10px);
    }
to {
 opacity: 1;
        transform: translateY(0);
    }
}

.taf-dropdown-header {
    padding: 1.25rem;
    border-bottom: 1px solid var(--taf-gray-100);
    text-align: center;
}

.taf-avatar-lg {
    width: 64px;
    height: 64px;
    border-radius: 50%;
 margin: 0 auto 0.75rem;
    display: block;
}

.taf-dropdown-user {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.taf-dropdown-user strong {
    font-size: 1rem;
    color: var(--taf-gray-900);
}

.taf-dropdown-user span {
    font-size: 0.875rem;
    color: var(--taf-gray-500);
}

.taf-dropdown-body {
    padding: 0.5rem;
}

.taf-dropdown-item {
    display: flex;
    align-items: center;
 gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: var(--taf-gray-700);
    text-decoration: none;
    border-radius: var(--taf-radius);
    transition: var(--taf-transition);
    font-weight: 500;
}

.taf-dropdown-item:hover {
    background: var(--taf-gray-50);
    color: var(--taf-primary);
}

.taf-dropdown-item i {
    width: 20px;
    color: var(--taf-gray-400);
}

.taf-dropdown-item:hover i {
    color: var(--taf-primary);
}

/* Mobile Dashboard Item Styling */
.taf-dropdown-item.taf-mobile-only {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    margin-bottom: 0.5rem;
}

.taf-dropdown-item.taf-mobile-only:hover {
    background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
}

.taf-dropdown-item.taf-mobile-only i {
    color: white;
}

.taf-dropdown-footer {
    padding: 0.75rem;
    border-top: 1px solid var(--taf-gray-100);
}

.taf-btn-logout {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem;
  background: var(--taf-red);
    color: white;
    border: none;
    border-radius: var(--taf-radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--taf-transition);
    font-size: 0.9375rem;
}

.taf-btn-logout:hover {
    background: var(--taf-red-dark);
}

/* ===== Mobile Menu Toggle ===== */
.taf-menu-toggle {
    display: none;
    flex-direction: column;
    gap: 4px;
    background: none;
    border: none;
    padding: 8px;
    cursor: pointer;
}

.taf-menu-toggle span {
width: 24px;
    height: 2px;
    background: var(--taf-gray-700);
    transition: var(--taf-transition);
}

/* ===== Overlay ===== */
.taf-nav-overlay {
    display: none;
    position: fixed;
    inset: 0;
background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s;
}

body.taf-nav-open .taf-nav-overlay {
    display: block;
    opacity: 1;
}

/* ===== Responsive Design ===== */

/* Desktop */
@@media (min-width: 1024px) {
.taf-nav-links {
     display: flex;
    }
    
    .taf-btn-dashboard {
  display: inline-flex;
    }
    
    .taf-mobile-only {
        display: none !important;
    }
}

/* Tablet & Mobile */
@@media (max-width: 1023px) {
    .taf-container {
        padding: 0 1rem;
    }

    .taf-menu-toggle {
     display: flex;
    }
  
    .taf-btn-dashboard {
        display: none !important;
    }
    
    .taf-mobile-only {
        display: flex !important;
    }
    
    .taf-nav-links {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
      background: white;
        flex-direction: column;
padding: 2rem 1.5rem;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  transform: translateX(-100%);
     transition: transform 0.3s;
        z-index: 1000;
      overflow-y: auto;
    }
    
    body.taf-nav-open .taf-nav-links {
     display: flex;
     transform: translateX(0);
    }
    
    .taf-link {
        width: 100%;
    }
    
    .taf-user-info {
        display: none;
    }
    
    .taf-btn span {
        display: none;
    }
}

/* Mobile */
@@media (max-width: 640px) {
    .taf-brand {
        font-size: 1.5rem;
}
    
    .taf-brand i {
  font-size: 1.25rem;
    }
    
    #tafNotifBtn {
        display: none;
    }
}
</style>

<!-- JavaScript -->
<script>
(function() {
    'use strict';
    
    document.addEventListener('DOMContentLoaded', function() {
// Mobile menu toggle
        const menuToggle = document.getElementById('tafMenuToggle');
        const navOverlay = document.getElementById('tafNavOverlay');
        const body = document.body;
        
  if (menuToggle) {
        menuToggle.addEventListener('click', function() {
          body.classList.toggle('taf-nav-open');
         });
        }
     
        if (navOverlay) {
            navOverlay.addEventListener('click', function() {
 body.classList.remove('taf-nav-open');
            });
 }
     
        // User menu dropdown
  const userToggle = document.getElementById('tafUserToggle');
        const userDropdown = document.getElementById('tafUserDropdown');
    
        if (userToggle && userDropdown) {
     userToggle.addEventListener('click', function(e) {
          e.stopPropagation();
              userDropdown.classList.toggle('show');
       });
  
            document.addEventListener('click', function(e) {
   if (!userToggle.contains(e.target) && !userDropdown.contains(e.target)) {
      userDropdown.classList.remove('show');
   }
        });
  }
        
        // Language toggle
        const langToggle = document.getElementById('tafLangToggle');
        if (langToggle) {
 langToggle.addEventListener('click', function() {
      // Add language switching logic here
        console.log('Language toggle clicked');
          });
 }
        
        // Close mobile menu when clicking on a link
    const navLinks = document.querySelectorAll('.taf-link');
        navLinks.forEach(function(link) {
        link.addEventListener('click', function() {
          body.classList.remove('taf-nav-open');
});
 });
        
        // ✅ NEW: Update cart count for customers
        @if (isAuthenticated && userRole == "Customer")
        {
            <text>
function updateCartCount() {
 fetch('@Url.Action("GetCartCount", "Store", new { area = "" })')
        .then(response => response.json())
    .then(data => {
       const badge = document.getElementById('cart-badge');
         if (badge && data.count > 0) {
   badge.textContent = data.count;
     badge.style.display = 'inline-block';
       } else if (badge) {
     badge.style.display = 'none';
          }
     })
    .catch(error => console.error('Error fetching cart count:', error));
            }
    
     // Update on page load
  updateCartCount();
   
 // Update every 30 seconds
      setInterval(updateCartCount, 30000);
        </text>
        }
    });
})();


// Tailor Management Links (for Tailors only)
@if (userRole == "Tailor")
{
    <a asp-area="Tailor" asp-controller="TailorManagement" asp-action="ManageProducts" class="taf-dropdown-item">
        <i class="fas fa-box"></i>
        <span>إدارة المنتجات</span>
    </a>
    <a asp-area="Tailor" asp-controller="TailorManagement" asp-action="AddProduct" class="taf-dropdown-item">
        <i class="fas fa-plus"></i>
        <span>إضافة منتج</span>
    </a>
    <a asp-area="Tailor" asp-controller="TailorManagement" asp-action="ManageServices" class="taf-dropdown-item">
        <i class="fas fa-concierge-bell"></i>
        <span>إدارة الخدمات</span>
    </a>
    <a asp-area="Tailor" asp-controller="TailorManagement" asp-action="ManagePortfolio" class="taf-dropdown-item">
        <i class="fas fa-images"></i>
        <span>معرض الأعمال</span>
    </a>
}
</script>

